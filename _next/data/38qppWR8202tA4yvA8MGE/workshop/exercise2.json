{"pageProps":{"post":{"mdxSource":"var Component=(()=>{var h=Object.create;var t=Object.defineProperty;var m=Object.getOwnPropertyDescriptor;var N=Object.getOwnPropertyNames;var k=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var r=a=>t(a,\"__esModule\",{value:!0});var g=(a,s)=>()=>(s||a((s={exports:{}}).exports,s),s.exports),y=(a,s)=>{r(a);for(var i in s)t(a,i,{get:s[i],enumerable:!0})},v=(a,s,i)=>{if(s&&typeof s==\"object\"||typeof s==\"function\")for(let n of N(s))!u.call(a,n)&&n!==\"default\"&&t(a,n,{get:()=>s[n],enumerable:!(i=m(s,n))||i.enumerable});return a},b=a=>v(r(t(a!=null?h(k(a)):{},\"default\",a&&a.__esModule&&\"default\"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);var d=g((S,o)=>{o.exports=_jsx_runtime});var C={};y(C,{default:()=>x,frontmatter:()=>f});var e=b(d()),f={title:\"Creating customised CVE reports with RHACS\",exercise:2,date:\"2024-06-02\",tags:[\"rhacs\",\"cve\",\"campaigns\",\"pwnkit\",\"openshift\",\"security\"],draft:!1,authors:[\"default\"],summary:\"In the second exercise we'll generate and export data for a CVE campaign, using the RHACS RESTful API.\"};function w(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(i,{})})):i();function i(){let n=Object.assign({p:\"p\",div:\"div\",ul:\"ul\",li:\"li\",code:\"code\",a:\"a\",strong:\"strong\",img:\"img\",pre:\"pre\",span:\"span\",h2:\"h2\"},a.components),{Zoom:l,Image:c}=n;return c||p(\"Image\",!0),l||p(\"Zoom\",!0),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(n.p,{children:\"Ok, we've seen now how to dig into a specific image and identify CVEs that is exposed to. Importantly, RHACS scans all images deployed to the platform - we know that any new deployments created will be scanned, and the results made available to RHACS analysts.\"}),(0,e.jsx)(n.p,{children:\"We identified a single image vulnerable to PwnKit (CVE-2021-4034). Now, let's assume that we want to build a report for CVE-2021-4034. Our reporting tools / platforms expect data in a CSV format, and we want to identify every workload or image that is vulnerable to CVE-2021-4034 and export this data.\"}),(0,e.jsx)(n.p,{children:\"To do this we'll use the Red Hat Advanced Cluster Security for Kubernetes (RHACS) RESTful application programming interface (API). This allows us to export data from RHACS using the API, and customise this before sending the data to another platform (like Splunk).\"}),(0,e.jsx)(n.p,{children:\"To begin, we need to create a policy for CVE-2021-4034. Navigate to 'Platform Configuration' -> 'Policy management'. This will show all policies that you get out-of-the-box with Red Hat Advanced Cluster Security for Kubernetes (RHACS).\"}),(0,e.jsx)(l,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"report1\",src:\"/static/images/exercise2/report1.png\",width:\"1728\",height:\"1050\"})})}),(0,e.jsx)(n.p,{children:\"There's a few important things to highlight:\"}),(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:\"Each policy has a 'status' field, enabling policies to be enabled / disabled.\"}),(0,e.jsx)(n.li,{children:\"Policies can have 'notifiers' attached. This allows you to notify external systems - such as Splunk, or PagerDuty - when policies are violated.\"}),(0,e.jsx)(n.li,{children:\"Policies have a configurable 'severity' field.\"})]}),(0,e.jsx)(n.p,{children:\"We can also see that each policy has a lifecycle. This determines how the policy is applied:\"}),(0,e.jsxs)(n.ul,{children:[(0,e.jsxs)(n.li,{children:[\"'Build' policies impact the \",(0,e.jsx)(n.code,{children:\"roxctl\"}),\" CLI, which can be included with CI/CD pipelines to scan container images as a software pipeline stage.\"]}),(0,e.jsx)(n.li,{children:\"'Deploy' policies invoke the Red Hat Advanced Cluster Security for Kubernetes (RHACS) admission controller. This allows us to block / notify when certain CVEs or misconfiguration are detected (we'll explore this in exercise 3).\"}),(0,e.jsxs)(n.li,{children:[\"'Runtime' policies apply to container process / network traffic detected for container workloads by the RHACS eBPF program (we'll explore runtime policies and \",(0,e.jsx)(n.a,{href:\"https://ebpf.io/what-is-ebpf/\",children:\"eBPF\"}),\" in exercise 4).\"]})]}),(0,e.jsx)(n.p,{children:\"We need to create a new policy, so select 'Create Policy'.\"}),(0,e.jsx)(l,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"report2\",src:\"/static/images/exercise2/report2.png\",width:\"1728\",height:\"1050\"})})}),(0,e.jsx)(n.p,{children:\"This will open up the 'Create Policy' form.\"}),(0,e.jsx)(l,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"report3\",src:\"/static/images/exercise2/report3.png\",width:\"1736\",height:\"1000\"})})}),(0,e.jsx)(n.p,{children:\"Enter the following data for the policy:\"}),(0,e.jsxs)(n.ul,{children:[(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Name\"}),\": PwnKit campaign < your username >\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Severity\"}),\": High\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Categories\"}),\": Vulnerability Management\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Description\"}),\": The polkit package is designed to define and handle policies that allow unprivileged processes to communicate with privileged processes on a Linux system. Pkexec, part of polkit, is a tool that allows the user to execute commands as another user according to the polkit policy definitions using the setuid feature. The vulnerability found in pkexec allows an unprivileged local attacker to escalate privileges, bypassing any authentication and policies due to incorrect handling of the process\\u2019s argument vector.\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Rationale\"}),\": Container images vulnerable to PwnKit are potentially exposed to privilege escalation techniques.\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Guidance\"}),\": Use the package manager for your base image to update polkit packages in container images to versions that are no longer vulnerable.\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:(0,e.jsx)(n.a,{href:\"https://attack.mitre.org/\",children:\"MITRE ATT&CK\"})}),\": Privilege Escalation (TA0004) -> Exploitation for Privilege Escalation (T1068).\"]})]}),(0,e.jsx)(l,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"report4\",src:\"/static/images/exercise2/report4.png\",width:\"1742\",height:\"1119\"})})}),(0,e.jsx)(l,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"report5\",src:\"/static/images/exercise2/report5.png\",width:\"1724\",height:\"1174\"})})}),(0,e.jsx)(n.p,{children:\"Click 'Next'. The next page defines the policy behavior. Select 'Build' and 'Deploy', and leave the 'Response method' set to 'Inform'.\"}),(0,e.jsx)(l,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"report6\",src:\"/static/images/exercise2/report6.png\",width:\"1747\",height:\"964\"})})}),(0,e.jsx)(n.p,{children:\"Select 'Next', and this next page defines the policy criteria.\"}),(0,e.jsx)(l,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"report7\",src:\"/static/images/exercise2/report7.png\",width:\"1739\",height:\"1044\"})})}),(0,e.jsx)(n.p,{children:\"Expand 'image contents' on the right-hand side to see additional criteria you can use in the policy.\"}),(0,e.jsx)(l,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"report8\",src:\"/static/images/exercise2/report8.png\",width:\"1739\",height:\"1044\"})})}),(0,e.jsxs)(n.p,{children:[\"Locate the \",(0,e.jsx)(n.code,{children:\"CVE\"}),\" field and drag it to the 'Policy section 1' field on the left. Update the CVE identifier for \",(0,e.jsx)(n.code,{children:\"CVE-2021-4034\"}),\".\"]}),(0,e.jsx)(l,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"report9\",src:\"/static/images/exercise2/report9.png\",width:\"1742\",height:\"1042\"})})}),(0,e.jsx)(n.p,{children:\"Select 'Next'. This screen allows us to limit the policy scope to certain clusters or namespaces, or exclude particular clusters from a policy. We're not going to make any changes here, so just click 'Next'.\"}),(0,e.jsx)(l,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"report10\",src:\"/static/images/exercise2/report10.png\",width:\"1750\",height:\"998\"})})}),(0,e.jsx)(n.p,{children:\"Finally you can review the policy. This screen will also show any existing deployments on the platform that fail the policy. When you're happy, click 'Save'.\"}),(0,e.jsx)(l,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"report11\",src:\"/static/images/exercise2/report11.png\",width:\"1727\",height:\"1129\"})})}),(0,e.jsx)(n.p,{children:\"Now that this policy is active we can use it to generate data for a CVE campaign. While we could use the built-in CVE reports, using the RESTful API for this specific campaign allows us to customise the data formatting, which can be very useful when we're pushing data between different platforms. Here, for example, we would like to export the data into a CSV format.\"}),(0,e.jsxs)(n.p,{children:[\"Login to OpenShift and Locate the \",(0,e.jsx)(n.code,{children:\"lab\"}),\" container inside your project namespace. Inside you'll find a script \",(0,e.jsx)(n.code,{children:\"/ex2/pwnkit-report.sh\"}),\".\"]}),(0,e.jsx)(l,{children:(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"access1\",src:\"/static/images/exercise2/ocp-access.gif\"})})}),(0,e.jsx)(n.p,{children:\"Let's take a look at this file:\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"code-highlight language-bash\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"cat\"}),` /ex2/pwnkit-report.sh\n`]})})}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token important shebang\",children:\"#! /bin/bash\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"set\"}),` -e\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"VERSION\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsxs)(n.span,{className:\"token variable\",children:[\"${VERSION\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":-\"}),\"v1}\"]}),'\"']}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\" -z \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${ROX_ENDPOINT}\"}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"then\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\">\"}),(0,e.jsx)(n.span,{className:\"token important file-descriptor\",children:\"&2\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ROX_ENDPOINT must be set\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"exit\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fi\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\" -z \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${ROX_API_TOKEN}\"}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"then\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\">\"}),(0,e.jsx)(n.span,{className:\"token important file-descriptor\",children:\"&2\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ROX_API_TOKEN must be set\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"exit\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fi\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\" -z \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"$1\"}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"then\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\">\"}),(0,e.jsx)(n.span,{className:\"token important file-descriptor\",children:\"&2\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"usage: create-csv.sh <output filename>\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"exit\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fi\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"output_file\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"$1\"}),'\"']}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${VERSION}\"}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"v1\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"then\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:`'\"Deployment\", \"Image\", \"CVE\", \"CVSS Score\", \"Summary\", \"Severity\", \"Component\", \"Version\", \"Fixed By\", \"Layer Index\", \"Layer Instruction\"'`}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\">\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${output_file}\"}),'\"']}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"elif\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${VERSION}\"}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"v2\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"then\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:`'\"Cluster Name\", \"Cluster Id\", \"Namespace\", \"Namespace Id\",\"Deployment\", \"Image\", \"CVE\", \"CVSS Score\", \"Summary\", \"Severity\", \"Component\", \"Version\", \"Fixed By\", \"Layer Index\", \"Layer Instruction\"'`}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\">\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${output_file}\"}),'\"']}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"else\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"Unknown version ',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${VERSION}\"}),' detected. v1 and v2 supported\"']}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"exit\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fi\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,e.jsx)(n.span,{className:\"token function function-name\",children:\"curl_central\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token function\",children:\"curl\"}),\" -sk -H \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"Authorization: Bearer ',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${ROX_API_TOKEN}\"}),'\"']}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"https://',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${ROX_ENDPOINT}\"}),\"/\",(0,e.jsx)(n.span,{className:\"token variable\",children:\"$1\"}),'\"']}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Collect all alerts\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"res\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$(\"}),\"curl_central \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"v1/alerts?query=Policy%3APwnKit%20Campaign%20user1\"'}),(0,e.jsx)(n.span,{className:\"token variable\",children:\")\"})]}),'\"']}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Iterate over all deployments and get the full deployment\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" \",(0,e.jsx)(n.span,{className:\"token variable for-or-select\",children:\"deployment_id\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$(\"}),(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${res}\"}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" jq -r .alerts\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\".deployment.id\",(0,e.jsx)(n.span,{className:\"token variable\",children:\")\"})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"do\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"deployment_res\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$(\"}),\"curl_central \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"v1/deployments/',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${deployment_id}\"}),'\"']}),(0,e.jsx)(n.span,{className:\"token variable\",children:\")\"})]}),'\"']}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$(\"}),(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${deployment_res}\"}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" jq -rc .name\",(0,e.jsx)(n.span,{className:\"token variable\",children:\")\"})]}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" null \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"then\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"continue\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fi\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  \n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$(\"}),(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${deployment_res}\"}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" jq \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'.containers | length'\"}),(0,e.jsx)(n.span,{className:\"token variable\",children:\")\"})]}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"0\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"then\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"continue\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fi\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"export\"}),\" \",(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"deployment_name\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$(\"}),(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${deployment_res}\"}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" jq -rc .name\",(0,e.jsx)(n.span,{className:\"token variable\",children:\")\"})]}),'\"']}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"export\"}),\" \",(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"namespace\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$(\"}),(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${deployment_res}\"}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" jq -rc .namespace\",(0,e.jsx)(n.span,{className:\"token variable\",children:\")\"})]}),'\"']}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"export\"}),\" \",(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"namespaceId\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$(\"}),(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${deployment_res}\"}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" jq -rc .namespaceId\",(0,e.jsx)(n.span,{className:\"token variable\",children:\")\"})]}),'\"']}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"export\"}),\" \",(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"clusterName\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$(\"}),(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${deployment_res}\"}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" jq -rc .clusterName\",(0,e.jsx)(n.span,{className:\"token variable\",children:\")\"})]}),'\"']}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"export\"}),\" \",(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"clusterId\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$(\"}),(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${deployment_res}\"}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" jq -rc .clusterId\",(0,e.jsx)(n.span,{className:\"token variable\",children:\")\"})]}),'\"']}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Iterate over all images within the deployment and render the CSV Lines\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" \",(0,e.jsx)(n.span,{className:\"token variable for-or-select\",children:\"image_id\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$(\"}),(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${deployment_res}\"}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" jq -r \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'select(.containers != null) | .containers[].image.id'\"}),(0,e.jsx)(n.span,{className:\"token variable\",children:\")\"})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"do\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"     \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${image_id}\"}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"then\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"       \",(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"image_res\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$(\"}),\"curl_central \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"v1/images/',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${image_id}\"}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" jq -rc\",(0,e.jsx)(n.span,{className:\"token variable\",children:\")\"})]}),'\"']}),` \n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"       \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$(\"}),(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${image_res}\"}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" jq -rc .name\",(0,e.jsx)(n.span,{className:\"token variable\",children:\")\"})]}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" null \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"then\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"continue\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"       \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fi\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"       \",(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"image_name\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$(\"}),(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${image_res}\"}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" jq -rc \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'.name.fullName'\"}),(0,e.jsx)(n.span,{className:\"token variable\",children:\")\"})]}),'\"']}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"       \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"export\"}),` image_name\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`       \n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"       \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Format the CSV correctly\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"       \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${VERSION}\"}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"v1\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"then\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${image_res}\"}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" jq -r \",(0,e.jsx)(n.span,{className:\"token string\",children:`'try (.metadata.v1.layers as $layers | .scan.components | sort_by(.layerIndex, .name) | .[]? | . as $component | select(.vulns != null) | .vulns[] | select(.fixedBy != null) |select(.cve == \"CVE-2021-4034\") | [ env.deployment_name, env.image_name, .cve, .cvss, .summary, .severity, $component.name, $component.version, .fixedBy, $component.layerIndex, ($layers[$component.layerIndex // 0].instruction + \" \" +$layers[$component.layerIndex // 0].value)]) | @csv'`}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\">>\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${output_file}\"}),'\"']}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"       \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"else\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${image_res}\"}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" jq -r \",(0,e.jsx)(n.span,{className:\"token string\",children:`'try (.metadata.v1.layers as $layers | .scan.components | sort_by(.layerIndex, .name) | .[]? | . as $component | select(.vulns != null) | .vulns[] | select(.fixedBy != null) | select(.cve == \"CVE-2021-4034\") | [ env.clusterName, env.clusterId, env.namespace, env.namespaceId, env.deployment_name, env.image_name, .cve, .cvss, .summary, .severity, $component.name, $component.version, .fixedBy, $component.layerIndex, ($layers[$component.layerIndex // 0].instruction + \" \" +$layers[$component.layerIndex // 0].value)]) | @csv'`}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\">>\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${output_file}\"}),'\"']}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"       \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fi\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"     \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fi\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"done\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"done\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Update the report to reflect your report name. If you've used the standard \",(0,e.jsx)(n.code,{children:\"PwnKit campaign %%user%%\"}),\" you can se \",(0,e.jsx)(n.code,{children:\"sed\"}),\" to replace the report name. Note that you can use 'ctrl-shift-v' to paste into the container terminal:\"]}),(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"code-highlight\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`sed -i s/user1/user2/g pwnkit-report.sh\n`})})}),(0,e.jsx)(n.p,{children:\"Before we run this script we need to create an API token to provide access to Red Hat Advanced Cluster Security for Kubernetes (RHACS). Navigate to 'Platform Configuration' -> 'Integrations' in the RHACS console, and scroll down to 'StackRox API token'.\"}),(0,e.jsx)(l,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"report12\",src:\"/static/images/exercise2/report12.png\",width:\"1722\",height:\"1187\"})})}),(0,e.jsx)(n.p,{children:\"Select 'API token' and then 'Generate token'\"}),(0,e.jsx)(l,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"report13\",src:\"/static/images/exercise2/report13.png\",width:\"1751\",height:\"876\"})})}),(0,e.jsx)(n.p,{children:\"Enter your username for the token name and give the token a role of 'Analyst'.\"}),(0,e.jsxs)(\"details\",{children:[(0,e.jsx)(\"summary\",{children:(0,e.jsx)(\"strong\",{children:\"What's the 'Analyst' role?\"})}),\" \",(0,e.jsx)(\"p\",{children:\"Red Hat Advanced Cluster Security for Kubernetes (RHACS) uses role-based access controls (RBAC) to limit the data and actions a user can perform.\"}),(0,e.jsx)(\"p\",{children:\"The 'Analyst' role is targeted for a user who cannot make any changes, but can view everything. It provides a good fit for customer reporting here because we can use it to provide read-only access for all resources.\"}),(0,e.jsxs)(\"p\",{children:[\"You can find the complete list of RHACS default roles in the \",(0,e.jsx)(n.a,{href:\"https://docs.openshift.com/acs/4.4/operating/manage-user-access/manage-role-based-access-control-3630.html#rbac-system-roles-3630_manage-role-based-access-control\",children:\"docs\"}),\".\"]})]}),\" \",(0,e.jsx)(l,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"report14\",src:\"/static/images/exercise2/report14.png\",width:\"1745\",height:\"887\"})})}),(0,e.jsx)(n.p,{children:\"Copy the token from the previous page and set it inside your terminal:\"}),(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"code-highlight\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`export ROX_API_TOKEN=eyJhb...\n`})})}),(0,e.jsx)(n.p,{children:\"Run the report.\"}),(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"code-highlight\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`./pwnkit-report.sh pwnkit.csv\n`})})}),(0,e.jsx)(n.p,{children:\"Take a look at the file that's been generated:\"}),(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`$ cat pwnkit.csv\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\"Deployment\", \"Image\", \"CVE\", \"CVSS Score\", \"Summary\", \"Severity\", \"Component\", \"Version\", \"Fixed By\", \"Layer Index\", \"Layer Instruction\"\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\"backend\",\"quay.io/the-worst-containers/pwnkit:v0.6\",\"CVE-2021-4034\",7.8,\"A local privilege escalation vulnerability was found on polkit's pkexec utility. The pkexec application is a setuid tool designed to allow unprivileged users to run commands as privileged users according predefined policies. The current version of pkexec doesn't handle the calling parameters count correctly and ends trying to execute environment variables as commands. An attacker can leverage this by crafting environment variables in such a way it'll induce pkexec to execute arbitrary code. When successfully executed the attack can cause a local privilege escalation given unprivileged users administrative rights on the target machine.\",\"IMPORTANT_VULNERABILITY_SEVERITY\",\"policykit-1\",\"0.105-18+deb9u1\",\"0.105-18+deb9u2\",6,\"RUN apt-get update && apt-get install -y libpolkit-gobject-1-0=0.105-18+deb9u1     libpolkit-agent-1-0=0.105-18+deb9u1     libpolkit-backend-1-0=0.105-18+deb9u1    policykit-1=0.105-18+deb9u1\"\n`})]})}),(0,e.jsx)(n.p,{children:\"Let's explore this data a little more:\"}),(0,e.jsxs)(n.ul,{children:[(0,e.jsxs)(n.li,{children:[\"There is a deployment active on the cluster named \",(0,e.jsx)(n.code,{children:\"backend\"}),\" that is vulnerable to PwnKit (CVE-2021-4034)\"]}),(0,e.jsxs)(n.li,{children:[\"The vulnerable container image associated with this deployment is \",(0,e.jsx)(n.code,{children:\"quay.io/the-worst-containers/pwnkit:v0.6\"})]}),(0,e.jsxs)(n.li,{children:[\"The vulnerability is introduced in the 0.105-18+deb9u1 version of the \",(0,e.jsx)(n.code,{children:\"policykit-1\"}),\" package, and is fixed in the 0.105-18+debu9u2 package.\"]}),(0,e.jsx)(n.li,{children:\"Specifically the vulnerability was introduced with the lines shown at the end of the file.\"})]}),(0,e.jsxs)(n.h2,{id:\"troubleshooting\",children:[(0,e.jsx)(n.a,{href:\"#troubleshooting\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Troubleshooting\"]}),(0,e.jsx)(n.p,{children:\"There are a few things that can go wrong generating the report. You may get a report output like this, with no other information:\"}),(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"code-highlight\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`\"Deployment\", \"Image\", \"CVE\", \"CVSS Score\", \"Summary\", \"Severity\", \"Component\", \"Version\", \"Fixed By\", \"Layer Index\", \"Layer Instruction\"\n`})})}),(0,e.jsx)(n.p,{children:\"If this happens, it's likely that the reporting script is looking for a differently named policy. Check the policy value in the script:\"}),(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`# Collect all alerts\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`res=\"$(curl_central \"v1/alerts?query=Policy%3APwnKit%20Campaign%20user1\")\"\n`})]})}),(0,e.jsxs)(n.h2,{id:\"summary\",children:[(0,e.jsx)(n.a,{href:\"#summary\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Summary\"]}),(0,e.jsx)(n.p,{children:\"In this lab we looked at creating reports for specific CVEs, using the Red Hat Advanced Cluster Security for Kubernetes (RHACS) RESTful API to extract data and present is as CSV-formatted files. This provides complete control over the report format and data, and can be exported to Splunk, Sentinel or other platforms for further analysis.\"}),(0,e.jsxs)(n.h2,{id:\"stretch-goals\",children:[(0,e.jsx)(n.a,{href:\"#stretch-goals\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Stretch goals\"]}),(0,e.jsx)(n.p,{children:\"Can you create a similar report for Log4Shell? Is there an existing policy that can help?\"})]})}}var x=w;function p(a,s){throw new Error(\"Expected \"+(s?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return C;})();\n;return Component;","toc":[{"value":"Troubleshooting","url":"#troubleshooting","depth":2},{"value":"Summary","url":"#summary","depth":2},{"value":"Stretch goals","url":"#stretch-goals","depth":2}],"frontMatter":{"readingTime":{"text":"11 min read","minutes":10.68,"time":640800,"words":2136},"slug":"exercise2","fileName":"exercise2.mdx","title":"Creating customised CVE reports with RHACS","exercise":2,"date":"2024-06-02T00:00:00.000Z","tags":["rhacs","cve","campaigns","pwnkit","openshift","security"],"draft":false,"authors":["default"],"summary":"In the second exercise we'll generate and export data for a CVE campaign, using the RHACS RESTful API."}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.24,"time":14400,"words":48},"slug":["default"],"fileName":"default.md","date":null}],"prev":{"title":"Vulnerability analysis with RHACS","exercise":1,"date":"2024-06-01T00:00:00.000Z","tags":["rhacs","cve","pwnkit","openshift","acs","containers"],"draft":false,"authors":["default"],"summary":"In this first exercise we'll analyze container images for vulnerabilities.","slug":"exercise1"},"next":{"title":"Blocking vulnerable workloads from OpenShift","exercise":3,"date":"2024-06-03T00:00:00.000Z","tags":["admission","control","openshift","rhacs","cve"],"draft":false,"authors":["default"],"summary":"In the third exercise we'll block vulnerable container images from OpenShift","slug":"exercise3"}},"__N_SSG":true}