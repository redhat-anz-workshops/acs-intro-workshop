---
title: Vulnerability analysis with RHACS
exercise: 1
date: '2024-06-01'
tags: ['rhacs','cve','pwnkit','openshift','acs','containers']
draft: false
authors: ['default']
summary: "In this first exercise we'll sign a container image using Sigstore."
---
In this first exercise we'll identify critical vulnerabilities in an OpenShift workload. This is important, because vulnerabilities can be present in either the underlying 'base' container image, or in the application code itself. Red Hat Advanced Cluster Security for Kubernetes (RHACS) supports identifying vulnerabilities in both.

### Supported base images
| Distribution | Version |
| --- | --- |
| Alpine Linux | alpine:3.2,alpine:3.3, alpine:3.4, alpine:3.5, alpine:3.6, alpine:3.7, alpine:3.8, alpine:3.9, alpine:3.10, alpine:3.11, alpine:3.12, alpine:3.13, alpine:3.14, alpine:3.15, alpine:3.16, alpine:3.17, alpine:3.18, alpine:3.19, alpine:edge |
| Amazon Linux | amzn:2018.03, amzn:2, amzn:2023 |
| CentOS | centos:6, centos:7, centos:8 |
| Debian | ebian:10, debian:11, debian:12, debian:unstable, distroless | 
| Oracle Linux | versions 5-9 |
| Photon OS | 1.0, 2.0, 3.0 |
| Red Hat Enterprise Linux (RHEL) | rhel:6, rhel:7, rhel:8, rhel:9 |
| SUSE | SLES 11, 12, 15; openSUSE Leap 42.3, 15.0, 15.1; SUSE Linux | 
| Ubuntu | ubuntu:14.04, ubuntu:16.04, ubuntu:18.04, ubuntu:20.04, ubuntu:21.04, ubuntu:21.10, ubuntu:22.04, ubuntu:22.10, ubuntu:23.04, ubuntu:23.10. The following vulnerability sources are not updated by the vendor: ubuntu:12.04, ubuntu:12.10, ubuntu:13.04, ubuntu:14.10, ubuntu:15.04, ubuntu::15.10, ubuntu::16.10, ubuntu:17.04, ubuntu:17.10, ubuntu:18.10, ubuntu:19.04, ubuntu:19.10, ubuntu:20.1 |

### Supported language runtimes and frameworks
| foo | bar |
| --- | --- |
| baz | bim |


## Identifying critical vulnerabilities
Navigate to RHACS and login with your OpenShift username and credentials:

<Zoom>
![login](/static/images/login.png)
</Zoom>

Navigate to **Vulnerability Management (1.0)**, and select 'images' in the top-right menu.

<Zoom>
![cve1](/static/images/exercise1/cve1.png)
</Zoom>

When RHACS is first-connected to an OpenShift cluster it will automatically perform a CVE scan of all images deployed to the cluster. You can see these shown in this screen - the 'Image Status -> Active' indicates that the image is associated with an active deployment.

<Zoom>
![cve2](/static/images/exercise1/cve2.png)
</Zoom>

Select the `quay.io/the-worst-containers/pwnkit:v0.6` image. If you can't see it on the first page, you can search for the image in the 'Filter images' bar.

<Zoom>
![cve3](/static/images/exercise1/cve3.png)
</Zoom>

<Zoom>
![cve4](/static/images/exercise1/cve4.png)
</Zoom>

Once you select the image you'll be shown a screen showing a summary of the image.

<Zoom>
![cve5](/static/images/exercise1/cve5.png)
</Zoom>

There's a few things we can see here:
- The top CVSS of any vulnerabilities present in this container image is 10.0
- The container image was created 30/05/2024, and was last scanned very recently. 
- The container image was scanned using the built-in Red Hat Advanced Cluster Security for Kubernetes (RHACS) CVE scanner, based on the open source Clair project.
- The image base OS is Debian 9. Debian 9 no longer produces new CVE data, and RHACS shows a message that the CVE data is now stale. 
- The image has 10 CVEs rated as critical, 36 rated as important, 29 rated as moderate and 200 rated as low. We're mostly interested in the critical and important CVEs.
- The top riskiest components and the number of CVEs identified are also shown.

## Tooltip -> stale CVE data

If you scroll down the page you'll be shown the list of all CVEs present in this container image. Let's filter this list for a specific CVE - CVE-2021-4034.

<Zoom>
![cve6](/static/images/exercise1/cve6.png)
</Zoom>

### A little about PwnKit
CVE-2021-4034 refers to a privilege escalation vulnerability in the Polkit package. 

Let's take a closer look at the component inside the container image that's vulnerable. Click `CVE-2021-4034` and you'll be shown a summary of the CVE.

<Zoom>
![cve7](/static/images/exercise1/cve7.png)
</Zoom>

The summary contains some other important data about this CVE:
- The CVSS score is 7.8
- The CVE has a patch available (`Fixable`)
- The CVE was first published 29/01/2022, and was first discovered in this environment very recently

You can also see a link the image component on the right-hand side of the screen.

<Zoom>
![cve8](/static/images/exercise1/cve8.png)
</Zoom>

Clicking this link will show the vulnerable component inside the container image. In this case, it's the `policykit-1` package installed into the container image. This screen also shows the package that fixes the CVE.

<Zoom>
![cve9](/static/images/exercise1/cve9.png)
</Zoom>

You can also dig further into this component and see any other CVEs that it is exposed to.

<Zoom>
![cve10](/static/images/exercise1/cve10.png)
</Zoom>

## Summary

This was a quick introduction to Red Hat Advanced Cluster Security for Kubernetes (RHACS). We looked at how to use RHACS to identify vulnerable container images, and dug into vulnerable components inside a container image.

In the next exercise, we'll look at creating a campaign for a specific CVE and extracting data from RHACS.

## Stretch goals
