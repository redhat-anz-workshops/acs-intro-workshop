<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><title>Creating CVE campaigns with RHACS</title><meta name="robots" content="follow, index"/><meta name="description" content="In the second exercise we&#x27;ll generate and export data for a CVE campaign, using the RHACS RESTful API."/><meta property="og:url" content="https://tssc.blueradish.net/workshop/exercise2"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Red Hat Advanced Cluster Security for Kubernetes Workshop"/><meta property="og:description" content="In the second exercise we&#x27;ll generate and export data for a CVE campaign, using the RHACS RESTful API."/><meta property="og:title" content="Creating CVE campaigns with RHACS"/><meta property="og:image" content="https://tssc.blueradish.net/static/images/twitter-card.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="https://twitter.com/shaneboulden"/><meta name="twitter:title" content="Creating CVE campaigns with RHACS"/><meta name="twitter:description" content="In the second exercise we&#x27;ll generate and export data for a CVE campaign, using the RHACS RESTful API."/><meta name="twitter:image" content="https://tssc.blueradish.net/static/images/twitter-card.png"/><meta property="article:published_time" content="2024-06-02T00:00:00.000Z"/><link rel="canonical" href="https://tssc.blueradish.net/workshop/exercise2"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://tssc.blueradish.net/workshop/exercise2"
  },
  "headline": "Creating CVE campaigns with RHACS",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://tssc.blueradish.net/static/images/twitter-card.png"
    }
  ],
  "datePublished": "2024-06-02T00:00:00.000Z",
  "dateModified": "2024-06-02T00:00:00.000Z",
  "author": [
    {
      "@type": "Person"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Red Hat",
    "logo": {
      "@type": "ImageObject",
      "url": "https://tssc.blueradish.net/static/images/redhat.png"
    }
  },
  "description": "In the second exercise we'll generate and export data for a CVE campaign, using the RHACS RESTful API."
}</script><meta name="next-head-count" content="20"/><link rel="apple-touch-icon" sizes="180x180" href="/static/favicons/apple-touch-icon.png?v=2"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png?v=2"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png?v=2"/><link rel="manifest" href="/static/favicons/site.webmanifest?v=2"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg?v=2" color="#5bbad5"/><link rel="shortcut icon" href="/static/favicons/favicon.ico?v=2"/><meta name="msapplication-TileColor" content="#2b5797"/><meta name="msapplication-config" content="/static/favicons/browserconfig.xml?v=2"/><meta name="theme-color" content="#ffffff"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link rel="preload" href="/acs-intro-workshop/_next/static/css/cf000565eb824de7.css" as="style"/><link rel="stylesheet" href="/acs-intro-workshop/_next/static/css/cf000565eb824de7.css" data-n-g=""/><link rel="preload" href="/acs-intro-workshop/_next/static/css/6d530d6069fd563f.css" as="style"/><link rel="stylesheet" href="/acs-intro-workshop/_next/static/css/6d530d6069fd563f.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/acs-intro-workshop/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/acs-intro-workshop/_next/static/chunks/webpack-cf5d75faf002f19c.js" defer=""></script><script src="/acs-intro-workshop/_next/static/chunks/main-5c24c561c2682111.js" defer=""></script><script src="/acs-intro-workshop/_next/static/chunks/pages/_app-93e4c5f4e998361e.js" defer=""></script><script src="/acs-intro-workshop/_next/static/chunks/675-d738c2290773a25c.js" defer=""></script><script src="/acs-intro-workshop/_next/static/chunks/281-077b66ad20884513.js" defer=""></script><script src="/acs-intro-workshop/_next/static/chunks/621-f365ba1428f7445c.js" defer=""></script><script src="/acs-intro-workshop/_next/static/chunks/pages/workshop/%5B...slug%5D-9b1baadadc9631e0.js" defer=""></script><script src="/acs-intro-workshop/_next/static/a12FD6jqS0b1NOE4U34cQ/_buildManifest.js" defer=""></script><script src="/acs-intro-workshop/_next/static/a12FD6jqS0b1NOE4U34cQ/_ssgManifest.js" defer=""></script><script src="/acs-intro-workshop/_next/static/a12FD6jqS0b1NOE4U34cQ/_middlewareManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap">@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuGKYMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuFuYMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body class="antialiased text-black bg-white dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="max-w-3xl px-4 mx-auto sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex flex-col justify-between h-screen"><header class="flex items-center justify-between py-10"><div><a aria-label="Tailwind CSS Blog" href="/acs-intro-workshop"><div class="flex items-center justify-between"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 228 228" width="39" height="30" style="enable-background:new 0 0 228 228" xml:space="preserve"><path d="M187.9 100.6c.3 1.3.4 2.7.4 4.1 0 17.7-21.5 20.7-36.3 20.7-57.8 0-100.8-35.9-100.8-46.8 0-.7 0-1.5.3-2.3L47 87c-1 2.3-1.8 5.4-1.8 8.7 0 21.5 48.6 54 104.2 54 24.6 0 43.3-9.2 43.3-25.9 0-1.3 0-2.3-2-12l-2.8-11.2z"></path><path d="M151.9 125.4c14.8 0 36.3-3.1 36.3-20.7 0-1.4 0-2.7-.4-4.1L179 62.2c-2.1-8.4-3.8-12.3-18.7-19.7-11.5-5.9-36.6-15.6-44-15.6-6.9 0-9 9-17.1 9-7.9 0-13.8-6.7-21.2-6.7-7.2 0-11.8 4.9-15.4 14.8 0 0-10 28.2-11.3 32.2-.3.8-.3 1.6-.3 2.3.1 11 43.2 46.9 100.9 46.9m38.7-13.5c2 9.7 2 10.7 2 12 0 16.6-18.7 25.9-43.3 25.9-55.5 0-104.2-32.5-104.2-54 0-3.3.8-6.4 1.8-8.7-20 1-45.8 4.6-45.8 27.4 0 37.4 88.6 83.4 158.7 83.4 53.8 0 67.3-24.3 67.3-43.5.1-15.1-13-32.3-36.5-42.5" style="fill:#e00"></path></svg></div><div class="hidden h-6 text-2xl font-semibold sm:block">Red Hat</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/acs-intro-workshop/workshop">Exercises</a><a target="_blank" rel="noopener noreferrer" href="https://etherpad.wikimedia.org/p/rhacs-workshop-june-2024" class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100">Etherpad</a></div><button aria-label="Toggle Dark Mode" type="button" class="w-8 h-8 p-1 ml-1 mr-1 rounded sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="w-8 h-8 ml-1 mr-1 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed w-full h-full top-24 right-0 bg-gray-200 dark:bg-gray-800 opacity-95 z-10 transform ease-in-out duration-300 translate-x-full"><button type="button" aria-label="toggle modal" class="fixed w-full h-full cursor-auto focus:outline-none"></button><nav class="fixed h-full mt-8"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/acs-intro-workshop/workshop">Exercises</a></div><div class="px-12 py-4"><a target="_blank" rel="noopener noreferrer" href="https://etherpad.wikimedia.org/p/rhacs-workshop-june-2024" class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100">Etherpad</a></div></nav></div></div></div></header><main class="mb-auto"><div class="max-w-3xl px-4 mx-auto sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400">Exercise <!-- -->2</dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Creating CVE campaigns with RHACS</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100"></dd><dt class="sr-only">Twitter</dt><dd></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><p>Ok, we&#x27;ve seen now how to dig into a specific image and identify CVEs that is exposed to. Importantly, RHACS scans all images deployed to the platform - we know that any new deployments created will be scanned, and the results made available to RHACS analysts.</p><p>We identified a single image vulnerable to PwnKit (CVE-2021-4034). Now, let&#x27;s assume that we want to run a campaign for CVE-2021-4034. We want to identify every workload or image that is vulnerable to CVE-2021-4034 and export this data into a separate platform.</p><p>To do this we&#x27;ll use the Red Hat Advanced Cluster Security for Kubernetes (RHACS) RESTful application programming interface (API). This allows us to export data from RHACS using the API, and customise this before sending the data to another platform (like Splunk).</p><p>To begin, we need to create a policy for CVE-2021-4034. Navigate to &#x27;Platform Configuration&#x27; -&gt; &#x27;Policy management&#x27;. This will show all policies that you get out-of-the-box with Red Hat Advanced Cluster Security for Kubernetes (RHACS).</p><div data-rmiz-wrap="visible"><div><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%271728%27%20height=%271050%27/%3e"/></span><img alt="report1" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="report1" srcSet="https://workshop-936810110.imgix.net/static/images/exercise2/report1.png?auto=format&amp;fit=max&amp;w=1920 1x, https://workshop-936810110.imgix.net/static/images/exercise2/report1.png?auto=format&amp;fit=max&amp;w=3840 2x" src="https://workshop-936810110.imgix.net/static/images/exercise2/report1.png?auto=format&amp;fit=max&amp;w=3840" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div><p>There&#x27;s a few important things to highlight:</p><ul><li>Each policy has a &#x27;status&#x27; field, enabling policies to be enabled / disabled.</li><li>Policies can have &#x27;notifiers&#x27; attached. This allows you to notify external systems - such as Splunk, or PagerDuty - when policies are violated.</li><li>Policies have a configurable &#x27;severity&#x27; field.</li></ul><p>We can also see that each policy has a lifecycle. This determines how the policy is applied:</p><ul><li>&#x27;Build&#x27; policies impact the <code>roxctl</code> CLI, which can be included with CI/CD pipelines to scan container images as a software pipeline stage.</li><li>&#x27;Deploy&#x27; policies invoke the Red Hat Advanced Cluster Security for Kubernetes (RHACS) admission controller. This allows us to block / notify when certain CVEs or misconfiguration are detected (we&#x27;ll explore this in exercise 2).</li><li>&#x27;Runtime&#x27; policies apply to container process / network traffic detected for container workloads by the RHACS eBPF program.</li></ul><p>We need to create a new policy, so select &#x27;Create Policy&#x27;.</p><div data-rmiz-wrap="visible"><div><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%271728%27%20height=%271050%27/%3e"/></span><img alt="report2" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="report2" srcSet="https://workshop-936810110.imgix.net/static/images/exercise2/report2.png?auto=format&amp;fit=max&amp;w=1920 1x, https://workshop-936810110.imgix.net/static/images/exercise2/report2.png?auto=format&amp;fit=max&amp;w=3840 2x" src="https://workshop-936810110.imgix.net/static/images/exercise2/report2.png?auto=format&amp;fit=max&amp;w=3840" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div><p>This will open up the &#x27;Create Policy&#x27; form.</p><div data-rmiz-wrap="visible"><div><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%271736%27%20height=%271000%27/%3e"/></span><img alt="report3" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="report3" srcSet="https://workshop-936810110.imgix.net/static/images/exercise2/report3.png?auto=format&amp;fit=max&amp;w=1920 1x, https://workshop-936810110.imgix.net/static/images/exercise2/report3.png?auto=format&amp;fit=max&amp;w=3840 2x" src="https://workshop-936810110.imgix.net/static/images/exercise2/report3.png?auto=format&amp;fit=max&amp;w=3840" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div><p>Enter the following data for the policy:</p><ul><li><strong>Name</strong>: PwnKit campaign &lt; your username &gt;</li><li><strong>Severity</strong>: High</li><li><strong>Categories</strong>: Vulnerability Management</li><li><strong>Description</strong>: The polkit package is designed to define and handle policies that allow unprivileged processes to communicate with privileged processes on a Linux system. Pkexec, part of polkit, is a tool that allows the user to execute commands as another user according to the polkit policy definitions using the setuid feature. The vulnerability found in pkexec allows an unprivileged local attacker to escalate privileges, bypassing any authentication and policies due to incorrect handling of the process’s argument vector.</li><li><strong>Rationale</strong>: Container images vulnerable to PwnKit are potentially exposed to privilege escalation techniques.</li><li><strong>Guidance</strong>: Use the package manager for your base image to update polkit packages in container images to versions that are no longer vulnerable.</li><li><strong>MITRE ATT&amp;CK</strong>: Privilege Escalation (TA0004) -&gt; Exploitation for Privilege Escalation (T1068).</li></ul><div data-rmiz-wrap="visible"><div><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%271742%27%20height=%271119%27/%3e"/></span><img alt="report4" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="report4" srcSet="https://workshop-936810110.imgix.net/static/images/exercise2/report4.png?auto=format&amp;fit=max&amp;w=1920 1x, https://workshop-936810110.imgix.net/static/images/exercise2/report4.png?auto=format&amp;fit=max&amp;w=3840 2x" src="https://workshop-936810110.imgix.net/static/images/exercise2/report4.png?auto=format&amp;fit=max&amp;w=3840" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div><div data-rmiz-wrap="visible"><div><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%271724%27%20height=%271174%27/%3e"/></span><img alt="report5" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="report5" srcSet="https://workshop-936810110.imgix.net/static/images/exercise2/report5.png?auto=format&amp;fit=max&amp;w=1920 1x, https://workshop-936810110.imgix.net/static/images/exercise2/report5.png?auto=format&amp;fit=max&amp;w=3840 2x" src="https://workshop-936810110.imgix.net/static/images/exercise2/report5.png?auto=format&amp;fit=max&amp;w=3840" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div><p>Click &#x27;Next&#x27;. The next page defines the policy behavior. Select &#x27;Build&#x27; and &#x27;Deploy&#x27;, and leave the &#x27;Response method&#x27; set to &#x27;Inform&#x27;.</p><div data-rmiz-wrap="visible"><div><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%271747%27%20height=%27964%27/%3e"/></span><img alt="report6" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="report6" srcSet="https://workshop-936810110.imgix.net/static/images/exercise2/report6.png?auto=format&amp;fit=max&amp;w=1920 1x, https://workshop-936810110.imgix.net/static/images/exercise2/report6.png?auto=format&amp;fit=max&amp;w=3840 2x" src="https://workshop-936810110.imgix.net/static/images/exercise2/report6.png?auto=format&amp;fit=max&amp;w=3840" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div><p>Select &#x27;Next&#x27;, and this next page defines the policy criteria.</p><div data-rmiz-wrap="visible"><div><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%271739%27%20height=%271044%27/%3e"/></span><img alt="report7" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="report7" srcSet="https://workshop-936810110.imgix.net/static/images/exercise2/report7.png?auto=format&amp;fit=max&amp;w=1920 1x, https://workshop-936810110.imgix.net/static/images/exercise2/report7.png?auto=format&amp;fit=max&amp;w=3840 2x" src="https://workshop-936810110.imgix.net/static/images/exercise2/report7.png?auto=format&amp;fit=max&amp;w=3840" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div><p>Expand &#x27;image contents&#x27; on the right-hand side to see additional criteria you can use in the policy.</p><div data-rmiz-wrap="visible"><div><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%271739%27%20height=%271044%27/%3e"/></span><img alt="report8" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="report8" srcSet="https://workshop-936810110.imgix.net/static/images/exercise2/report8.png?auto=format&amp;fit=max&amp;w=1920 1x, https://workshop-936810110.imgix.net/static/images/exercise2/report8.png?auto=format&amp;fit=max&amp;w=3840 2x" src="https://workshop-936810110.imgix.net/static/images/exercise2/report8.png?auto=format&amp;fit=max&amp;w=3840" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div><p>Locate the <code>CVE</code> field and drag it to the &#x27;Policy section 1&#x27; field on the left. Update the CVE identifier for <code>CVE-2021-4034</code>.</p><div data-rmiz-wrap="visible"><div><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%271742%27%20height=%271042%27/%3e"/></span><img alt="report9" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="report9" srcSet="https://workshop-936810110.imgix.net/static/images/exercise2/report9.png?auto=format&amp;fit=max&amp;w=1920 1x, https://workshop-936810110.imgix.net/static/images/exercise2/report9.png?auto=format&amp;fit=max&amp;w=3840 2x" src="https://workshop-936810110.imgix.net/static/images/exercise2/report9.png?auto=format&amp;fit=max&amp;w=3840" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div><p>Select &#x27;Next&#x27;. This screen allows us to limit the policy scope to certain clusters or namespaces, or exclude particular clusters from a policy. We&#x27;re not going to make any changes here, so just click &#x27;Next&#x27;.</p><div data-rmiz-wrap="visible"><div><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%271750%27%20height=%27998%27/%3e"/></span><img alt="report10" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="report10" srcSet="https://workshop-936810110.imgix.net/static/images/exercise2/report10.png?auto=format&amp;fit=max&amp;w=1920 1x, https://workshop-936810110.imgix.net/static/images/exercise2/report10.png?auto=format&amp;fit=max&amp;w=3840 2x" src="https://workshop-936810110.imgix.net/static/images/exercise2/report10.png?auto=format&amp;fit=max&amp;w=3840" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div><p>Finally you can review the policy. This screen will also show any existing deployments on the platform that fail the policy. When you&#x27;re happy, click &#x27;Save&#x27;.</p><div data-rmiz-wrap="visible"><div><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%271727%27%20height=%271129%27/%3e"/></span><img alt="report11" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="report11" srcSet="https://workshop-936810110.imgix.net/static/images/exercise2/report11.png?auto=format&amp;fit=max&amp;w=1920 1x, https://workshop-936810110.imgix.net/static/images/exercise2/report11.png?auto=format&amp;fit=max&amp;w=3840 2x" src="https://workshop-936810110.imgix.net/static/images/exercise2/report11.png?auto=format&amp;fit=max&amp;w=3840" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div><p>Now that this policy is active we can use it to generate data for a CVE campaign. While we could use the built-in CVE reports, using the RESTful API for this specific campaign allows us to customise the data formatting, which can be very useful when we&#x27;re pushing data between different platforms.</p><p>Locate the <code>workshop</code> container inside your project namespace. Inside you&#x27;ll find a script <code>pwnkit-campaign.sh</code>.</p><p>Let&#x27;s take a look at this file:</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line"><span class="token important shebang">#! /bin/bash</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token builtin class-name">set</span> -e
</span><span class="code-line">
</span><span class="code-line"><span class="token variable assign-left">VERSION</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${VERSION<span class="token operator">:-</span>v1}</span>&quot;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">${ROX_ENDPOINT}</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
</span><span class="code-line">  <span class="token builtin class-name">echo</span> <span class="token operator">&gt;</span><span class="token important file-descriptor">&amp;2</span> <span class="token string">&quot;ROX_ENDPOINT must be set&quot;</span>
</span><span class="code-line">  <span class="token builtin class-name">exit</span> <span class="token number">1</span>
</span><span class="code-line"><span class="token keyword">fi</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">${ROX_API_TOKEN}</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
</span><span class="code-line">  <span class="token builtin class-name">echo</span> <span class="token operator">&gt;</span><span class="token important file-descriptor">&amp;2</span> <span class="token string">&quot;ROX_API_TOKEN must be set&quot;</span>
</span><span class="code-line">  <span class="token builtin class-name">exit</span> <span class="token number">1</span>
</span><span class="code-line"><span class="token keyword">fi</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">$1</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
</span><span class="code-line">  <span class="token builtin class-name">echo</span> <span class="token operator">&gt;</span><span class="token important file-descriptor">&amp;2</span> <span class="token string">&quot;usage: create-csv.sh &lt;output filename&gt;&quot;</span>
</span><span class="code-line">  <span class="token builtin class-name">exit</span> <span class="token number">1</span>
</span><span class="code-line"><span class="token keyword">fi</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token variable assign-left">output_file</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$1</span>&quot;</span>
</span><span class="code-line"><span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">${VERSION}</span>&quot;</span> <span class="token operator">==</span> <span class="token string">&quot;v1&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
</span><span class="code-line">  <span class="token builtin class-name">echo</span> <span class="token string">&#x27;&quot;Deployment&quot;, &quot;Image&quot;, &quot;CVE&quot;, &quot;CVSS Score&quot;, &quot;Summary&quot;, &quot;Severity&quot;, &quot;Component&quot;, &quot;Version&quot;, &quot;Fixed By&quot;, &quot;Layer Index&quot;, &quot;Layer Instruction&quot;&#x27;</span> <span class="token operator">&gt;</span> <span class="token string">&quot;<span class="token variable">${output_file}</span>&quot;</span>
</span><span class="code-line"><span class="token keyword">elif</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">${VERSION}</span>&quot;</span> <span class="token operator">==</span> <span class="token string">&quot;v2&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
</span><span class="code-line">  <span class="token builtin class-name">echo</span> <span class="token string">&#x27;&quot;Cluster Name&quot;, &quot;Cluster Id&quot;, &quot;Namespace&quot;, &quot;Namespace Id&quot;,&quot;Deployment&quot;, &quot;Image&quot;, &quot;CVE&quot;, &quot;CVSS Score&quot;, &quot;Summary&quot;, &quot;Severity&quot;, &quot;Component&quot;, &quot;Version&quot;, &quot;Fixed By&quot;, &quot;Layer Index&quot;, &quot;Layer Instruction&quot;&#x27;</span> <span class="token operator">&gt;</span> <span class="token string">&quot;<span class="token variable">${output_file}</span>&quot;</span>
</span><span class="code-line"><span class="token keyword">else</span>
</span><span class="code-line">  <span class="token builtin class-name">echo</span> <span class="token string">&quot;Unknown version <span class="token variable">${VERSION}</span> detected. v1 and v2 supported&quot;</span>
</span><span class="code-line">  <span class="token builtin class-name">exit</span> <span class="token number">1</span>
</span><span class="code-line"><span class="token keyword">fi</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">function</span> <span class="token function function-name">curl_central</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token function">curl</span> -sk -H <span class="token string">&quot;Authorization: Bearer <span class="token variable">${ROX_API_TOKEN}</span>&quot;</span> <span class="token string">&quot;https://<span class="token variable">${ROX_ENDPOINT}</span>/<span class="token variable">$1</span>&quot;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># Collect all alerts</span>
</span><span class="code-line"><span class="token variable assign-left">res</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span>curl_central <span class="token string">&quot;v1/alerts?query=Policy%3APwnKit%20Campaign%20user1&quot;</span><span class="token variable">)</span></span>&quot;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># Iterate over all deployments and get the full deployment</span>
</span><span class="code-line"><span class="token keyword">for</span> <span class="token variable for-or-select">deployment_id</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">${res}</span>&quot;</span> <span class="token operator">|</span> jq -r .alerts<span class="token punctuation">[</span><span class="token punctuation">]</span>.deployment.id<span class="token variable">)</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span>
</span><span class="code-line">  <span class="token variable assign-left">deployment_res</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span>curl_central <span class="token string">&quot;v1/deployments/<span class="token variable">${deployment_id}</span>&quot;</span><span class="token variable">)</span></span>&quot;</span>
</span><span class="code-line">  <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">${deployment_res}</span>&quot;</span> <span class="token operator">|</span> jq -rc .name<span class="token variable">)</span></span>&quot;</span> <span class="token operator">==</span> null <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
</span><span class="code-line">   <span class="token builtin class-name">continue</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token keyword">fi</span>
</span><span class="code-line">  
</span><span class="code-line">  <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">${deployment_res}</span>&quot;</span> <span class="token operator">|</span> jq <span class="token string">&#x27;.containers | length&#x27;</span><span class="token variable">)</span></span>&quot;</span> <span class="token operator">==</span> <span class="token string">&quot;0&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
</span><span class="code-line">   <span class="token builtin class-name">continue</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token keyword">fi</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token builtin class-name">export</span> <span class="token variable assign-left">deployment_name</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">${deployment_res}</span>&quot;</span> <span class="token operator">|</span> jq -rc .name<span class="token variable">)</span></span>&quot;</span>
</span><span class="code-line">  <span class="token builtin class-name">export</span> <span class="token variable assign-left">namespace</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">${deployment_res}</span>&quot;</span> <span class="token operator">|</span> jq -rc .namespace<span class="token variable">)</span></span>&quot;</span>
</span><span class="code-line">  <span class="token builtin class-name">export</span> <span class="token variable assign-left">namespaceId</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">${deployment_res}</span>&quot;</span> <span class="token operator">|</span> jq -rc .namespaceId<span class="token variable">)</span></span>&quot;</span>
</span><span class="code-line">  <span class="token builtin class-name">export</span> <span class="token variable assign-left">clusterName</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">${deployment_res}</span>&quot;</span> <span class="token operator">|</span> jq -rc .clusterName<span class="token variable">)</span></span>&quot;</span>
</span><span class="code-line">  <span class="token builtin class-name">export</span> <span class="token variable assign-left">clusterId</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">${deployment_res}</span>&quot;</span> <span class="token operator">|</span> jq -rc .clusterId<span class="token variable">)</span></span>&quot;</span>
</span><span class="code-line">
</span><span class="code-line">   <span class="token comment"># Iterate over all images within the deployment and render the CSV Lines</span>
</span><span class="code-line">   <span class="token keyword">for</span> <span class="token variable for-or-select">image_id</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">${deployment_res}</span>&quot;</span> <span class="token operator">|</span> jq -r <span class="token string">&#x27;select(.containers != null) | .containers[].image.id&#x27;</span><span class="token variable">)</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span>
</span><span class="code-line">     <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">${image_id}</span>&quot;</span> <span class="token operator">!=</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
</span><span class="code-line">       <span class="token variable assign-left">image_res</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span>curl_central <span class="token string">&quot;v1/images/<span class="token variable">${image_id}</span>&quot;</span> <span class="token operator">|</span> jq -rc<span class="token variable">)</span></span>&quot;</span> 
</span><span class="code-line">       <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">${image_res}</span>&quot;</span> <span class="token operator">|</span> jq -rc .name<span class="token variable">)</span></span>&quot;</span> <span class="token operator">==</span> null <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
</span><span class="code-line">        <span class="token builtin class-name">continue</span><span class="token punctuation">;</span>
</span><span class="code-line">       <span class="token keyword">fi</span>
</span><span class="code-line">
</span><span class="code-line">       <span class="token variable assign-left">image_name</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">${image_res}</span>&quot;</span> <span class="token operator">|</span> jq -rc <span class="token string">&#x27;.name.fullName&#x27;</span><span class="token variable">)</span></span>&quot;</span>
</span><span class="code-line">       <span class="token builtin class-name">export</span> image_name
</span><span class="code-line">       
</span><span class="code-line">       <span class="token comment"># Format the CSV correctly</span>
</span><span class="code-line">       <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">${VERSION}</span>&quot;</span> <span class="token operator">==</span> <span class="token string">&quot;v1&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
</span><span class="code-line">         <span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">${image_res}</span>&quot;</span> <span class="token operator">|</span> jq -r <span class="token string">&#x27;try (.metadata.v1.layers as $layers | .scan.components | sort_by(.layerIndex, .name) | .[]? | . as $component | select(.vulns != null) | .vulns[] | select(.fixedBy != null) |select(.cve == &quot;CVE-2021-4034&quot;) | [ env.deployment_name, env.image_name, .cve, .cvss, .summary, .severity, $component.name, $component.version, .fixedBy, $component.layerIndex, ($layers[$component.layerIndex // 0].instruction + &quot; &quot; +$layers[$component.layerIndex // 0].value)]) | @csv&#x27;</span> <span class="token operator">&gt;&gt;</span> <span class="token string">&quot;<span class="token variable">${output_file}</span>&quot;</span>
</span><span class="code-line">       <span class="token keyword">else</span>
</span><span class="code-line">         <span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">${image_res}</span>&quot;</span> <span class="token operator">|</span> jq -r <span class="token string">&#x27;try (.metadata.v1.layers as $layers | .scan.components | sort_by(.layerIndex, .name) | .[]? | . as $component | select(.vulns != null) | .vulns[] | select(.fixedBy != null) | select(.cve == &quot;CVE-2021-4034&quot;) | [ env.clusterName, env.clusterId, env.namespace, env.namespaceId, env.deployment_name, env.image_name, .cve, .cvss, .summary, .severity, $component.name, $component.version, .fixedBy, $component.layerIndex, ($layers[$component.layerIndex // 0].instruction + &quot; &quot; +$layers[$component.layerIndex // 0].value)]) | @csv&#x27;</span> <span class="token operator">&gt;&gt;</span> <span class="token string">&quot;<span class="token variable">${output_file}</span>&quot;</span>
</span><span class="code-line">       <span class="token keyword">fi</span>
</span><span class="code-line">     <span class="token keyword">fi</span>
</span><span class="code-line">  <span class="token keyword">done</span>
</span><span class="code-line"><span class="token keyword">done</span>
</span></code></pre></div><p>Before we run this script we need to create an API token to provide access to Red Hat Advanced Cluster Security for Kubernetes (RHACS). Navigate to &#x27;Platform Configuration&#x27; -&gt; &#x27;Integrations&#x27; in the RHACS console, and scroll down to &#x27;StackRox API token&#x27;.</p><div data-rmiz-wrap="visible"><div><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%271722%27%20height=%271187%27/%3e"/></span><img alt="report12" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="report12" srcSet="https://workshop-936810110.imgix.net/static/images/exercise2/report12.png?auto=format&amp;fit=max&amp;w=1920 1x, https://workshop-936810110.imgix.net/static/images/exercise2/report12.png?auto=format&amp;fit=max&amp;w=3840 2x" src="https://workshop-936810110.imgix.net/static/images/exercise2/report12.png?auto=format&amp;fit=max&amp;w=3840" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div><p>Select &#x27;API token&#x27; and then &#x27;Generate token&#x27;</p><div data-rmiz-wrap="visible"><div><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%271751%27%20height=%27876%27/%3e"/></span><img alt="report13" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="report13" srcSet="https://workshop-936810110.imgix.net/static/images/exercise2/report13.png?auto=format&amp;fit=max&amp;w=1920 1x, https://workshop-936810110.imgix.net/static/images/exercise2/report13.png?auto=format&amp;fit=max&amp;w=3840 2x" src="https://workshop-936810110.imgix.net/static/images/exercise2/report13.png?auto=format&amp;fit=max&amp;w=3840" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div><p>Enter your username for the token name and give the token a role of &#x27;Analyst&#x27;.</p><div data-rmiz-wrap="visible"><div><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%271745%27%20height=%27887%27/%3e"/></span><img alt="report14" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="report14" srcSet="https://workshop-936810110.imgix.net/static/images/exercise2/report14.png?auto=format&amp;fit=max&amp;w=1920 1x, https://workshop-936810110.imgix.net/static/images/exercise2/report14.png?auto=format&amp;fit=max&amp;w=3840 2x" src="https://workshop-936810110.imgix.net/static/images/exercise2/report14.png?auto=format&amp;fit=max&amp;w=3840" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div><p>Copy the token from the previous page and set it inside your terminal:</p><div class="relative"><pre><code class="code-highlight"><span class="code-line">export ROX_API_TOKEN=eyJhb...
</span></code></pre></div><p>Set the ROX_ENDPOINT value to your cluster URL, and run the report.</p><div class="relative"><pre><code class="code-highlight"><span class="code-line">export ROX_ENDPOINT=central-acs-central.apps.cluster1.sandbox2237.opentlc.com
</span><span class="code-line">./pwnkit-report.sh pwnkit.csv
</span></code></pre></div><p>Take a look at the file that&#x27;s been generated:</p><div class="relative"><pre><code class="code-highlight"><span class="code-line">$ cat pwnkit.csv
</span><span class="code-line">&quot;Deployment&quot;, &quot;Image&quot;, &quot;CVE&quot;, &quot;CVSS Score&quot;, &quot;Summary&quot;, &quot;Severity&quot;, &quot;Component&quot;, &quot;Version&quot;, &quot;Fixed By&quot;, &quot;Layer Index&quot;, &quot;Layer Instruction&quot;
</span><span class="code-line">&quot;backend&quot;,&quot;quay.io/the-worst-containers/pwnkit:v0.6&quot;,&quot;CVE-2021-4034&quot;,7.8,&quot;A local privilege escalation vulnerability was found on polkit&#x27;s pkexec utility. The pkexec application is a setuid tool designed to allow unprivileged users to run commands as privileged users according predefined policies. The current version of pkexec doesn&#x27;t handle the calling parameters count correctly and ends trying to execute environment variables as commands. An attacker can leverage this by crafting environment variables in such a way it&#x27;ll induce pkexec to execute arbitrary code. When successfully executed the attack can cause a local privilege escalation given unprivileged users administrative rights on the target machine.&quot;,&quot;IMPORTANT_VULNERABILITY_SEVERITY&quot;,&quot;policykit-1&quot;,&quot;0.105-18+deb9u1&quot;,&quot;0.105-18+deb9u2&quot;,6,&quot;RUN apt-get update &amp;&amp; apt-get install -y libpolkit-gobject-1-0=0.105-18+deb9u1     libpolkit-agent-1-0=0.105-18+deb9u1     libpolkit-backend-1-0=0.105-18+deb9u1    policykit-1=0.105-18+deb9u1&quot;
</span></code></pre></div><p>Let&#x27;s explore this data a little more:</p><ul><li>There is a deployment deployed on the cluster named <code>backend</code> that is vulnerable to PwnKit (CVE-2021-4034)</li><li>The vulnerable container image associated with this deployment is <code>quay.io/the-worst-containers/pwnkit:v0.6</code></li><li>The vulnerability is introduced in the 0.105-18+deb9u1 version of the <code>policykit-1</code> package, and is fixed in the 0.105-18+debu9u2 package.</li><li>Specifically the vulnerability was introduced with the lines shown at the end of the file.</li></ul><h2 id="troubleshooting"><a href="#troubleshooting" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Troubleshooting</h2><p>There are a few things that can go wrong generating the report. You may get a report output like this, with no other information:</p><div class="relative"><pre><code class="code-highlight"><span class="code-line">&quot;Deployment&quot;, &quot;Image&quot;, &quot;CVE&quot;, &quot;CVSS Score&quot;, &quot;Summary&quot;, &quot;Severity&quot;, &quot;Component&quot;, &quot;Version&quot;, &quot;Fixed By&quot;, &quot;Layer Index&quot;, &quot;Layer Instruction&quot;
</span></code></pre></div><p>If this happens, it&#x27;s likely that the reporting script is looking for a differently named policy. Check the policy value in the script:</p><div class="relative"><pre><code class="code-highlight"><span class="code-line"># Collect all alerts
</span><span class="code-line">res=&quot;$(curl_central &quot;v1/alerts?query=Policy%3APwnKit%20Campaign%20user1&quot;)&quot;
</span></code></pre></div><h2 id="stretch-goals"><a href="#stretch-goals" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Stretch goals</h2><p>Can you create a similar policy / report for Log4Shell? Is there an existing policy that can help?</p></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-800 hover:text-primary-900 dark:hover:text-primary-400" href="/acs-intro-workshop/tags/rhacs">rhacs</a><a class="mr-3 text-sm font-medium uppercase text-primary-800 hover:text-primary-900 dark:hover:text-primary-400" href="/acs-intro-workshop/tags/cve">cve</a><a class="mr-3 text-sm font-medium uppercase text-primary-800 hover:text-primary-900 dark:hover:text-primary-400" href="/acs-intro-workshop/tags/campaigns">campaigns</a><a class="mr-3 text-sm font-medium uppercase text-primary-800 hover:text-primary-900 dark:hover:text-primary-400" href="/acs-intro-workshop/tags/pwnkit">pwnkit</a><a class="mr-3 text-sm font-medium uppercase text-primary-800 hover:text-primary-900 dark:hover:text-primary-400" href="/acs-intro-workshop/tags/openshift">openshift</a><a class="mr-3 text-sm font-medium uppercase text-primary-800 hover:text-primary-900 dark:hover:text-primary-400" href="/acs-intro-workshop/tags/security">security</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Exercise</h2><div class="text-primary-800 hover:text-primary-900 dark:hover:text-primary-400"><a href="/acs-intro-workshop/workshop/exercise1">Vulnerability analysis with RHACS</a></div></div><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Next Exercise</h2><div class="text-primary-800 hover:text-primary-900 dark:hover:text-primary-400"><a href="/acs-intro-workshop/workshop/exercise3">Blocking vulnerable workloads from OpenShift</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-800 hover:text-primary-900 dark:hover:text-primary-400" href="/acs-intro-workshop/workshop">← Back to the exercise list</a></div></footer></div></div></article></div></main><footer><div class="flex flex-col items-center mt-16"><div class="flex mb-2 space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>© 2024</div><div> • </div><a href="/acs-intro-workshop">Red Hat</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var h=Object.create;var t=Object.defineProperty;var m=Object.getOwnPropertyDescriptor;var N=Object.getOwnPropertyNames;var k=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var r=a=\u003et(a,\"__esModule\",{value:!0});var g=(a,s)=\u003e()=\u003e(s||a((s={exports:{}}).exports,s),s.exports),y=(a,s)=\u003e{r(a);for(var i in s)t(a,i,{get:s[i],enumerable:!0})},v=(a,s,i)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let n of N(s))!u.call(a,n)\u0026\u0026n!==\"default\"\u0026\u0026t(a,n,{get:()=\u003es[n],enumerable:!(i=m(s,n))||i.enumerable});return a},b=a=\u003ev(r(t(a!=null?h(k(a)):{},\"default\",a\u0026\u0026a.__esModule\u0026\u0026\"default\"in a?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a);var d=g(($,o)=\u003e{o.exports=_jsx_runtime});var I={};y(I,{default:()=\u003ex,frontmatter:()=\u003ef});var e=b(d()),f={title:\"Creating CVE campaigns with RHACS\",exercise:2,date:\"2024-06-02\",tags:[\"rhacs\",\"cve\",\"campaigns\",\"pwnkit\",\"openshift\",\"security\"],draft:!1,authors:[\"default\"],summary:\"In the second exercise we'll generate and export data for a CVE campaign, using the RHACS RESTful API.\"};function w(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(i,{})})):i();function i(){let n=Object.assign({p:\"p\",div:\"div\",ul:\"ul\",li:\"li\",code:\"code\",strong:\"strong\",pre:\"pre\",span:\"span\",h2:\"h2\",a:\"a\"},a.components),{Zoom:l,Image:c}=n;return c||p(\"Image\",!0),l||p(\"Zoom\",!0),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(n.p,{children:\"Ok, we've seen now how to dig into a specific image and identify CVEs that is exposed to. Importantly, RHACS scans all images deployed to the platform - we know that any new deployments created will be scanned, and the results made available to RHACS analysts.\"}),(0,e.jsx)(n.p,{children:\"We identified a single image vulnerable to PwnKit (CVE-2021-4034). Now, let's assume that we want to run a campaign for CVE-2021-4034. We want to identify every workload or image that is vulnerable to CVE-2021-4034 and export this data into a separate platform.\"}),(0,e.jsx)(n.p,{children:\"To do this we'll use the Red Hat Advanced Cluster Security for Kubernetes (RHACS) RESTful application programming interface (API). This allows us to export data from RHACS using the API, and customise this before sending the data to another platform (like Splunk).\"}),(0,e.jsx)(n.p,{children:\"To begin, we need to create a policy for CVE-2021-4034. Navigate to 'Platform Configuration' -\u003e 'Policy management'. This will show all policies that you get out-of-the-box with Red Hat Advanced Cluster Security for Kubernetes (RHACS).\"}),(0,e.jsx)(l,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"report1\",src:\"/static/images/exercise2/report1.png\",width:\"1728\",height:\"1050\"})})}),(0,e.jsx)(n.p,{children:\"There's a few important things to highlight:\"}),(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:\"Each policy has a 'status' field, enabling policies to be enabled / disabled.\"}),(0,e.jsx)(n.li,{children:\"Policies can have 'notifiers' attached. This allows you to notify external systems - such as Splunk, or PagerDuty - when policies are violated.\"}),(0,e.jsx)(n.li,{children:\"Policies have a configurable 'severity' field.\"})]}),(0,e.jsx)(n.p,{children:\"We can also see that each policy has a lifecycle. This determines how the policy is applied:\"}),(0,e.jsxs)(n.ul,{children:[(0,e.jsxs)(n.li,{children:[\"'Build' policies impact the \",(0,e.jsx)(n.code,{children:\"roxctl\"}),\" CLI, which can be included with CI/CD pipelines to scan container images as a software pipeline stage.\"]}),(0,e.jsx)(n.li,{children:\"'Deploy' policies invoke the Red Hat Advanced Cluster Security for Kubernetes (RHACS) admission controller. This allows us to block / notify when certain CVEs or misconfiguration are detected (we'll explore this in exercise 2).\"}),(0,e.jsx)(n.li,{children:\"'Runtime' policies apply to container process / network traffic detected for container workloads by the RHACS eBPF program.\"})]}),(0,e.jsx)(n.p,{children:\"We need to create a new policy, so select 'Create Policy'.\"}),(0,e.jsx)(l,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"report2\",src:\"/static/images/exercise2/report2.png\",width:\"1728\",height:\"1050\"})})}),(0,e.jsx)(n.p,{children:\"This will open up the 'Create Policy' form.\"}),(0,e.jsx)(l,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"report3\",src:\"/static/images/exercise2/report3.png\",width:\"1736\",height:\"1000\"})})}),(0,e.jsx)(n.p,{children:\"Enter the following data for the policy:\"}),(0,e.jsxs)(n.ul,{children:[(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Name\"}),\": PwnKit campaign \u003c your username \u003e\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Severity\"}),\": High\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Categories\"}),\": Vulnerability Management\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Description\"}),\": The polkit package is designed to define and handle policies that allow unprivileged processes to communicate with privileged processes on a Linux system. Pkexec, part of polkit, is a tool that allows the user to execute commands as another user according to the polkit policy definitions using the setuid feature. The vulnerability found in pkexec allows an unprivileged local attacker to escalate privileges, bypassing any authentication and policies due to incorrect handling of the process\\u2019s argument vector.\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Rationale\"}),\": Container images vulnerable to PwnKit are potentially exposed to privilege escalation techniques.\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Guidance\"}),\": Use the package manager for your base image to update polkit packages in container images to versions that are no longer vulnerable.\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"MITRE ATT\u0026CK\"}),\": Privilege Escalation (TA0004) -\u003e Exploitation for Privilege Escalation (T1068).\"]})]}),(0,e.jsx)(l,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"report4\",src:\"/static/images/exercise2/report4.png\",width:\"1742\",height:\"1119\"})})}),(0,e.jsx)(l,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"report5\",src:\"/static/images/exercise2/report5.png\",width:\"1724\",height:\"1174\"})})}),(0,e.jsx)(n.p,{children:\"Click 'Next'. The next page defines the policy behavior. Select 'Build' and 'Deploy', and leave the 'Response method' set to 'Inform'.\"}),(0,e.jsx)(l,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"report6\",src:\"/static/images/exercise2/report6.png\",width:\"1747\",height:\"964\"})})}),(0,e.jsx)(n.p,{children:\"Select 'Next', and this next page defines the policy criteria.\"}),(0,e.jsx)(l,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"report7\",src:\"/static/images/exercise2/report7.png\",width:\"1739\",height:\"1044\"})})}),(0,e.jsx)(n.p,{children:\"Expand 'image contents' on the right-hand side to see additional criteria you can use in the policy.\"}),(0,e.jsx)(l,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"report8\",src:\"/static/images/exercise2/report8.png\",width:\"1739\",height:\"1044\"})})}),(0,e.jsxs)(n.p,{children:[\"Locate the \",(0,e.jsx)(n.code,{children:\"CVE\"}),\" field and drag it to the 'Policy section 1' field on the left. Update the CVE identifier for \",(0,e.jsx)(n.code,{children:\"CVE-2021-4034\"}),\".\"]}),(0,e.jsx)(l,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"report9\",src:\"/static/images/exercise2/report9.png\",width:\"1742\",height:\"1042\"})})}),(0,e.jsx)(n.p,{children:\"Select 'Next'. This screen allows us to limit the policy scope to certain clusters or namespaces, or exclude particular clusters from a policy. We're not going to make any changes here, so just click 'Next'.\"}),(0,e.jsx)(l,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"report10\",src:\"/static/images/exercise2/report10.png\",width:\"1750\",height:\"998\"})})}),(0,e.jsx)(n.p,{children:\"Finally you can review the policy. This screen will also show any existing deployments on the platform that fail the policy. When you're happy, click 'Save'.\"}),(0,e.jsx)(l,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"report11\",src:\"/static/images/exercise2/report11.png\",width:\"1727\",height:\"1129\"})})}),(0,e.jsx)(n.p,{children:\"Now that this policy is active we can use it to generate data for a CVE campaign. While we could use the built-in CVE reports, using the RESTful API for this specific campaign allows us to customise the data formatting, which can be very useful when we're pushing data between different platforms.\"}),(0,e.jsxs)(n.p,{children:[\"Locate the \",(0,e.jsx)(n.code,{children:\"workshop\"}),\" container inside your project namespace. Inside you'll find a script \",(0,e.jsx)(n.code,{children:\"pwnkit-campaign.sh\"}),\".\"]}),(0,e.jsx)(n.p,{children:\"Let's take a look at this file:\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token important shebang\",children:\"#! /bin/bash\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"set\"}),` -e\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"VERSION\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsxs)(n.span,{className:\"token variable\",children:[\"${VERSION\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":-\"}),\"v1}\"]}),'\"']}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\" -z \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${ROX_ENDPOINT}\"}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"then\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),(0,e.jsx)(n.span,{className:\"token important file-descriptor\",children:\"\u00262\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ROX_ENDPOINT must be set\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"exit\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fi\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\" -z \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${ROX_API_TOKEN}\"}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"then\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),(0,e.jsx)(n.span,{className:\"token important file-descriptor\",children:\"\u00262\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ROX_API_TOKEN must be set\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"exit\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fi\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\" -z \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"$1\"}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"then\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),(0,e.jsx)(n.span,{className:\"token important file-descriptor\",children:\"\u00262\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"usage: create-csv.sh \u003coutput filename\u003e\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"exit\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fi\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"output_file\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"$1\"}),'\"']}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${VERSION}\"}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"v1\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"then\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:`'\"Deployment\", \"Image\", \"CVE\", \"CVSS Score\", \"Summary\", \"Severity\", \"Component\", \"Version\", \"Fixed By\", \"Layer Index\", \"Layer Instruction\"'`}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${output_file}\"}),'\"']}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"elif\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${VERSION}\"}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"v2\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"then\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:`'\"Cluster Name\", \"Cluster Id\", \"Namespace\", \"Namespace Id\",\"Deployment\", \"Image\", \"CVE\", \"CVSS Score\", \"Summary\", \"Severity\", \"Component\", \"Version\", \"Fixed By\", \"Layer Index\", \"Layer Instruction\"'`}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${output_file}\"}),'\"']}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"else\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"Unknown version ',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${VERSION}\"}),' detected. v1 and v2 supported\"']}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"exit\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fi\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,e.jsx)(n.span,{className:\"token function function-name\",children:\"curl_central\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token function\",children:\"curl\"}),\" -sk -H \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"Authorization: Bearer ',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${ROX_API_TOKEN}\"}),'\"']}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"https://',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${ROX_ENDPOINT}\"}),\"/\",(0,e.jsx)(n.span,{className:\"token variable\",children:\"$1\"}),'\"']}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Collect all alerts\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"res\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$(\"}),\"curl_central \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"v1/alerts?query=Policy%3APwnKit%20Campaign%20user1\"'}),(0,e.jsx)(n.span,{className:\"token variable\",children:\")\"})]}),'\"']}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Iterate over all deployments and get the full deployment\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" \",(0,e.jsx)(n.span,{className:\"token variable for-or-select\",children:\"deployment_id\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$(\"}),(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${res}\"}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" jq -r .alerts\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\".deployment.id\",(0,e.jsx)(n.span,{className:\"token variable\",children:\")\"})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"do\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"deployment_res\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$(\"}),\"curl_central \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"v1/deployments/',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${deployment_id}\"}),'\"']}),(0,e.jsx)(n.span,{className:\"token variable\",children:\")\"})]}),'\"']}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$(\"}),(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${deployment_res}\"}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" jq -rc .name\",(0,e.jsx)(n.span,{className:\"token variable\",children:\")\"})]}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" null \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"then\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"continue\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fi\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  \n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$(\"}),(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${deployment_res}\"}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" jq \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'.containers | length'\"}),(0,e.jsx)(n.span,{className:\"token variable\",children:\")\"})]}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"0\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"then\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"continue\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fi\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"export\"}),\" \",(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"deployment_name\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$(\"}),(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${deployment_res}\"}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" jq -rc .name\",(0,e.jsx)(n.span,{className:\"token variable\",children:\")\"})]}),'\"']}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"export\"}),\" \",(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"namespace\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$(\"}),(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${deployment_res}\"}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" jq -rc .namespace\",(0,e.jsx)(n.span,{className:\"token variable\",children:\")\"})]}),'\"']}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"export\"}),\" \",(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"namespaceId\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$(\"}),(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${deployment_res}\"}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" jq -rc .namespaceId\",(0,e.jsx)(n.span,{className:\"token variable\",children:\")\"})]}),'\"']}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"export\"}),\" \",(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"clusterName\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$(\"}),(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${deployment_res}\"}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" jq -rc .clusterName\",(0,e.jsx)(n.span,{className:\"token variable\",children:\")\"})]}),'\"']}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"export\"}),\" \",(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"clusterId\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$(\"}),(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${deployment_res}\"}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" jq -rc .clusterId\",(0,e.jsx)(n.span,{className:\"token variable\",children:\")\"})]}),'\"']}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Iterate over all images within the deployment and render the CSV Lines\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" \",(0,e.jsx)(n.span,{className:\"token variable for-or-select\",children:\"image_id\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$(\"}),(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${deployment_res}\"}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" jq -r \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'select(.containers != null) | .containers[].image.id'\"}),(0,e.jsx)(n.span,{className:\"token variable\",children:\")\"})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"do\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"     \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${image_id}\"}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"then\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"       \",(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"image_res\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$(\"}),\"curl_central \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"v1/images/',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${image_id}\"}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" jq -rc\",(0,e.jsx)(n.span,{className:\"token variable\",children:\")\"})]}),'\"']}),` \n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"       \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$(\"}),(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${image_res}\"}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" jq -rc .name\",(0,e.jsx)(n.span,{className:\"token variable\",children:\")\"})]}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" null \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"then\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"continue\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"       \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fi\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"       \",(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"image_name\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$(\"}),(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${image_res}\"}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" jq -rc \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'.name.fullName'\"}),(0,e.jsx)(n.span,{className:\"token variable\",children:\")\"})]}),'\"']}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"       \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"export\"}),` image_name\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`       \n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"       \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Format the CSV correctly\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"       \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${VERSION}\"}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"v1\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"then\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${image_res}\"}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" jq -r \",(0,e.jsx)(n.span,{className:\"token string\",children:`'try (.metadata.v1.layers as $layers | .scan.components | sort_by(.layerIndex, .name) | .[]? | . as $component | select(.vulns != null) | .vulns[] | select(.fixedBy != null) |select(.cve == \"CVE-2021-4034\") | [ env.deployment_name, env.image_name, .cve, .cvss, .summary, .severity, $component.name, $component.version, .fixedBy, $component.layerIndex, ($layers[$component.layerIndex // 0].instruction + \" \" +$layers[$component.layerIndex // 0].value)]) | @csv'`}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\u003e\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${output_file}\"}),'\"']}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"       \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"else\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${image_res}\"}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" jq -r \",(0,e.jsx)(n.span,{className:\"token string\",children:`'try (.metadata.v1.layers as $layers | .scan.components | sort_by(.layerIndex, .name) | .[]? | . as $component | select(.vulns != null) | .vulns[] | select(.fixedBy != null) | select(.cve == \"CVE-2021-4034\") | [ env.clusterName, env.clusterId, env.namespace, env.namespaceId, env.deployment_name, env.image_name, .cve, .cvss, .summary, .severity, $component.name, $component.version, .fixedBy, $component.layerIndex, ($layers[$component.layerIndex // 0].instruction + \" \" +$layers[$component.layerIndex // 0].value)]) | @csv'`}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\u003e\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${output_file}\"}),'\"']}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"       \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fi\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"     \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fi\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"done\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"done\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"Before we run this script we need to create an API token to provide access to Red Hat Advanced Cluster Security for Kubernetes (RHACS). Navigate to 'Platform Configuration' -\u003e 'Integrations' in the RHACS console, and scroll down to 'StackRox API token'.\"}),(0,e.jsx)(l,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"report12\",src:\"/static/images/exercise2/report12.png\",width:\"1722\",height:\"1187\"})})}),(0,e.jsx)(n.p,{children:\"Select 'API token' and then 'Generate token'\"}),(0,e.jsx)(l,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"report13\",src:\"/static/images/exercise2/report13.png\",width:\"1751\",height:\"876\"})})}),(0,e.jsx)(n.p,{children:\"Enter your username for the token name and give the token a role of 'Analyst'.\"}),(0,e.jsx)(l,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"report14\",src:\"/static/images/exercise2/report14.png\",width:\"1745\",height:\"887\"})})}),(0,e.jsx)(n.p,{children:\"Copy the token from the previous page and set it inside your terminal:\"}),(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"code-highlight\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`export ROX_API_TOKEN=eyJhb...\n`})})}),(0,e.jsx)(n.p,{children:\"Set the ROX_ENDPOINT value to your cluster URL, and run the report.\"}),(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`export ROX_ENDPOINT=central-acs-central.apps.cluster1.sandbox2237.opentlc.com\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`./pwnkit-report.sh pwnkit.csv\n`})]})}),(0,e.jsx)(n.p,{children:\"Take a look at the file that's been generated:\"}),(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`$ cat pwnkit.csv\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\"Deployment\", \"Image\", \"CVE\", \"CVSS Score\", \"Summary\", \"Severity\", \"Component\", \"Version\", \"Fixed By\", \"Layer Index\", \"Layer Instruction\"\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\"backend\",\"quay.io/the-worst-containers/pwnkit:v0.6\",\"CVE-2021-4034\",7.8,\"A local privilege escalation vulnerability was found on polkit's pkexec utility. The pkexec application is a setuid tool designed to allow unprivileged users to run commands as privileged users according predefined policies. The current version of pkexec doesn't handle the calling parameters count correctly and ends trying to execute environment variables as commands. An attacker can leverage this by crafting environment variables in such a way it'll induce pkexec to execute arbitrary code. When successfully executed the attack can cause a local privilege escalation given unprivileged users administrative rights on the target machine.\",\"IMPORTANT_VULNERABILITY_SEVERITY\",\"policykit-1\",\"0.105-18+deb9u1\",\"0.105-18+deb9u2\",6,\"RUN apt-get update \u0026\u0026 apt-get install -y libpolkit-gobject-1-0=0.105-18+deb9u1     libpolkit-agent-1-0=0.105-18+deb9u1     libpolkit-backend-1-0=0.105-18+deb9u1    policykit-1=0.105-18+deb9u1\"\n`})]})}),(0,e.jsx)(n.p,{children:\"Let's explore this data a little more:\"}),(0,e.jsxs)(n.ul,{children:[(0,e.jsxs)(n.li,{children:[\"There is a deployment deployed on the cluster named \",(0,e.jsx)(n.code,{children:\"backend\"}),\" that is vulnerable to PwnKit (CVE-2021-4034)\"]}),(0,e.jsxs)(n.li,{children:[\"The vulnerable container image associated with this deployment is \",(0,e.jsx)(n.code,{children:\"quay.io/the-worst-containers/pwnkit:v0.6\"})]}),(0,e.jsxs)(n.li,{children:[\"The vulnerability is introduced in the 0.105-18+deb9u1 version of the \",(0,e.jsx)(n.code,{children:\"policykit-1\"}),\" package, and is fixed in the 0.105-18+debu9u2 package.\"]}),(0,e.jsx)(n.li,{children:\"Specifically the vulnerability was introduced with the lines shown at the end of the file.\"})]}),(0,e.jsxs)(n.h2,{id:\"troubleshooting\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#troubleshooting\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Troubleshooting\"]}),(0,e.jsx)(n.p,{children:\"There are a few things that can go wrong generating the report. You may get a report output like this, with no other information:\"}),(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"code-highlight\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`\"Deployment\", \"Image\", \"CVE\", \"CVSS Score\", \"Summary\", \"Severity\", \"Component\", \"Version\", \"Fixed By\", \"Layer Index\", \"Layer Instruction\"\n`})})}),(0,e.jsx)(n.p,{children:\"If this happens, it's likely that the reporting script is looking for a differently named policy. Check the policy value in the script:\"}),(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`# Collect all alerts\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`res=\"$(curl_central \"v1/alerts?query=Policy%3APwnKit%20Campaign%20user1\")\"\n`})]})}),(0,e.jsxs)(n.h2,{id:\"stretch-goals\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#stretch-goals\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Stretch goals\"]}),(0,e.jsx)(n.p,{children:\"Can you create a similar policy / report for Log4Shell? Is there an existing policy that can help?\"})]})}}var x=w;function p(a,s){throw new Error(\"Expected \"+(s?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return I;})();\n;return Component;","toc":[{"value":"Troubleshooting","url":"#troubleshooting","depth":2},{"value":"Stretch goals","url":"#stretch-goals","depth":2}],"frontMatter":{"readingTime":{"text":"10 min read","minutes":9.69,"time":581400,"words":1938},"slug":"exercise2","fileName":"exercise2.mdx","title":"Creating CVE campaigns with RHACS","exercise":2,"date":"2024-06-02T00:00:00.000Z","tags":["rhacs","cve","campaigns","pwnkit","openshift","security"],"draft":false,"authors":["default"],"summary":"In the second exercise we'll generate and export data for a CVE campaign, using the RHACS RESTful API."}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.24,"time":14400,"words":48},"slug":["default"],"fileName":"default.md","date":null}],"prev":{"title":"Vulnerability analysis with RHACS","exercise":1,"date":"2024-06-01T00:00:00.000Z","tags":["rhacs","cve","pwnkit","openshift","acs","containers"],"draft":false,"authors":["default"],"summary":"In this first exercise we'll analyze container images for vulnerabilities.","slug":"exercise1"},"next":{"title":"Blocking vulnerable workloads from OpenShift","exercise":3,"date":"2024-06-03T00:00:00.000Z","tags":["admission","control","openshift","rhacs","cve"],"draft":false,"authors":["default"],"summary":"In the third exercise we'll block vulnerable container images from OpenShift","slug":"exercise3"}},"__N_SSG":true},"page":"/workshop/[...slug]","query":{"slug":["exercise2"]},"buildId":"a12FD6jqS0b1NOE4U34cQ","assetPrefix":"/acs-intro-workshop","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>