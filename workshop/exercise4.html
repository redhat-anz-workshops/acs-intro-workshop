<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><title>Detecting unauthorized application behaviour at runtime with RHACS</title><meta name="robots" content="follow, index"/><meta name="description" content="In this exercise we&#x27;ll identify and block unauthorized behaviours in container applications at runtime."/><meta property="og:url" content="https://tssc.blueradish.net/workshop/exercise4"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Red Hat Advanced Cluster Security for Kubernetes Workshop"/><meta property="og:description" content="In this exercise we&#x27;ll identify and block unauthorized behaviours in container applications at runtime."/><meta property="og:title" content="Detecting unauthorized application behaviour at runtime with RHACS"/><meta property="og:image" content="https://tssc.blueradish.net/static/images/twitter-card.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="https://twitter.com/shaneboulden"/><meta name="twitter:title" content="Detecting unauthorized application behaviour at runtime with RHACS"/><meta name="twitter:description" content="In this exercise we&#x27;ll identify and block unauthorized behaviours in container applications at runtime."/><meta name="twitter:image" content="https://tssc.blueradish.net/static/images/twitter-card.png"/><meta property="article:published_time" content="2024-06-04T00:00:00.000Z"/><link rel="canonical" href="https://tssc.blueradish.net/workshop/exercise4"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://tssc.blueradish.net/workshop/exercise4"
  },
  "headline": "Detecting unauthorized application behaviour at runtime with RHACS",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://tssc.blueradish.net/static/images/twitter-card.png"
    }
  ],
  "datePublished": "2024-06-04T00:00:00.000Z",
  "dateModified": "2024-06-04T00:00:00.000Z",
  "author": [
    {
      "@type": "Person"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Red Hat",
    "logo": {
      "@type": "ImageObject",
      "url": "https://tssc.blueradish.net/static/images/redhat.png"
    }
  },
  "description": "In this exercise we'll identify and block unauthorized behaviours in container applications at runtime."
}</script><meta name="next-head-count" content="20"/><link rel="apple-touch-icon" sizes="180x180" href="/static/favicons/apple-touch-icon.png?v=2"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png?v=2"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png?v=2"/><link rel="manifest" href="/static/favicons/site.webmanifest?v=2"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg?v=2" color="#5bbad5"/><link rel="shortcut icon" href="/static/favicons/favicon.ico?v=2"/><meta name="msapplication-TileColor" content="#2b5797"/><meta name="msapplication-config" content="/static/favicons/browserconfig.xml?v=2"/><meta name="theme-color" content="#ffffff"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link data-next-font="" rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/acs-intro-workshop/_next/static/css/c765b2071639cad1.css" as="style"/><link rel="stylesheet" href="/acs-intro-workshop/_next/static/css/c765b2071639cad1.css" data-n-g=""/><link rel="preload" href="/acs-intro-workshop/_next/static/css/6d530d6069fd563f.css" as="style"/><link rel="stylesheet" href="/acs-intro-workshop/_next/static/css/6d530d6069fd563f.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/acs-intro-workshop/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js"></script><script src="/acs-intro-workshop/_next/static/chunks/webpack-f0964fa994f7d701.js" defer=""></script><script src="/acs-intro-workshop/_next/static/chunks/main-4fbf6d6e3e7f89e9.js" defer=""></script><script src="/acs-intro-workshop/_next/static/chunks/pages/_app-7fbbd4a072665b9e.js" defer=""></script><script src="/acs-intro-workshop/_next/static/chunks/675-ab1c32210a69eebe.js" defer=""></script><script src="/acs-intro-workshop/_next/static/chunks/329-981c399b42fc6a71.js" defer=""></script><script src="/acs-intro-workshop/_next/static/chunks/782-2f60569a5ccbcc66.js" defer=""></script><script src="/acs-intro-workshop/_next/static/chunks/pages/workshop/%5B...slug%5D-9c81ff1983fad6aa.js" defer=""></script><script src="/acs-intro-workshop/_next/static/3OTyFijNBoIsio-CpMbkl/_buildManifest.js" defer=""></script><script src="/acs-intro-workshop/_next/static/3OTyFijNBoIsio-CpMbkl/_ssgManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap">@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuGKYMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuFuYMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body class="antialiased text-black bg-white dark:bg-gray-900 dark:text-white"><div id="__next"><div class="max-w-3xl px-4 mx-auto sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex flex-col justify-between h-screen"><header class="flex items-center justify-between py-10"><div><a href="/acs-intro-workshop"><a aria-label="Tailwind CSS Blog"><div class="flex items-center justify-between"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 228 228" width="39" height="30" style="enable-background:new 0 0 228 228" xml:space="preserve"><path d="M187.9 100.6c.3 1.3.4 2.7.4 4.1 0 17.7-21.5 20.7-36.3 20.7-57.8 0-100.8-35.9-100.8-46.8 0-.7 0-1.5.3-2.3L47 87c-1 2.3-1.8 5.4-1.8 8.7 0 21.5 48.6 54 104.2 54 24.6 0 43.3-9.2 43.3-25.9 0-1.3 0-2.3-2-12l-2.8-11.2z"></path><path d="M151.9 125.4c14.8 0 36.3-3.1 36.3-20.7 0-1.4 0-2.7-.4-4.1L179 62.2c-2.1-8.4-3.8-12.3-18.7-19.7-11.5-5.9-36.6-15.6-44-15.6-6.9 0-9 9-17.1 9-7.9 0-13.8-6.7-21.2-6.7-7.2 0-11.8 4.9-15.4 14.8 0 0-10 28.2-11.3 32.2-.3.8-.3 1.6-.3 2.3.1 11 43.2 46.9 100.9 46.9m38.7-13.5c2 9.7 2 10.7 2 12 0 16.6-18.7 25.9-43.3 25.9-55.5 0-104.2-32.5-104.2-54 0-3.3.8-6.4 1.8-8.7-20 1-45.8 4.6-45.8 27.4 0 37.4 88.6 83.4 158.7 83.4 53.8 0 67.3-24.3 67.3-43.5.1-15.1-13-32.3-36.5-42.5" style="fill:#e00"></path></svg></div><div class="hidden h-6 text-2xl font-semibold sm:block">Red Hat</div></div></a></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a href="/acs-intro-workshop/workshop"><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100">Exercises</a></a></div><a href="https://etherpad.wikimedia.org/p/rhacs-workshop-june-2024" target="_blank" rel="noopener noreferrer" class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100">Etherpad</a><button aria-label="Toggle Dark Mode" type="button" class="w-8 h-8 p-1 ml-1 mr-1 rounded sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="w-8 h-8 ml-1 mr-1 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed w-full h-full top-24 right-0 bg-gray-200 dark:bg-gray-800 opacity-95 z-10 transform ease-in-out duration-300 translate-x-full"><button type="button" aria-label="toggle modal" class="fixed w-full h-full cursor-auto focus:outline-none"></button><nav class="fixed h-full mt-8"><div class="px-12 py-4"><a href="/acs-intro-workshop/workshop"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100">Exercises</a></a></div></nav></div></div></div></header><main class="mb-auto"><div class="max-w-3xl px-4 mx-auto sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400">Exercise <!-- -->4</dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Detecting unauthorized application behaviour at runtime with RHACS</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100"></dd><dt class="sr-only">Twitter</dt><dd></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><p>Throughout this workshop we&#x27;ve looked at &#x27;PwnKit&#x27;, a vulnerability in the PolKit package potentially allowing privileged escalation. So far we&#x27;ve looked at:</p><ul><li>Analyzing container images for CVEs, and identifying vulnerable OpenShift workloads</li><li>Running a campaign for PwnKit-vulnerable container images and deployments</li><li>Blocking container images vulnerable to PwnKit from being deployed to OpenShift</li></ul><p>One of the critical requirements to exploit PwnKit is that users can interactively run <code>pkexec</code> from a container. In this lab, we&#x27;ll look at detecting and preventing <code>pkexec</code> usage from within containers, mitigating PwnKit exploitation.</p><h2 id="red-hat-advanced-cluster-security-for-kubernetes-rhacs-runtime-security"><a href="#red-hat-advanced-cluster-security-for-kubernetes-rhacs-runtime-security" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Red Hat Advanced Cluster Security for Kubernetes (RHACS) runtime security</h2><p>Historically, the operating system has always been an ideal place to implement observability, security, and networking functionality due to the kernel’s privileged ability to oversee and control the entire system. At the same time, an operating system kernel is hard to evolve due to its central role and high requirement towards stability and security. The rate of innovation at the operating system level has thus traditionally been lower compared to functionality implemented outside of the operating system.</p><p>The extended Berkeley Packet Filter (eBPF) changes this formula fundamentally. It allows sandboxed programs to run within the operating system, which means that application developers can run eBPF programs to add additional capabilities to the operating system at runtime. The operating system then guarantees safety and execution efficiency as if natively compiled with the aid of a Just-In-Time (JIT) compiler and verification engine. This has led to a wave of eBPF-based projects covering a wide array of use cases, including next-generation networking, observability, and security functionality.</p><p>Today, eBPF is used extensively to drive a wide variety of use cases: Providing high-performance networking and load-balancing in modern data centers and cloud native environments, extracting fine-grained security observability data at low overhead, helping application developers trace applications, providing insights for performance troubleshooting, preventive application and container runtime security enforcement, and much more. The possibilities are endless, and the innovation that eBPF is unlocking has only just begun.</p><p>Red Hat Advanced Cluster Security for Kubernetes (RHACS) uses an eBPF probe to detect processes running in containers, and also detect container network traffic flows. The eBPF probe runs on every Red Hat Enterprise Linux CoreOS (RHCOS) node of an OpenShift cluster.</p><h2 id="detecting-pkexec-in-containers"><a href="#detecting-pkexec-in-containers" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Detecting pkexec in containers</h2><p>Our goal in this lab is to detect and prevent the <code>pkexec</code> binary being used in containers. To do this, we can implement a runtime policy in Red Hat Advanced Cluster Security for Kubernetes (RHACS).</p><p>Navigate to &#x27;Platform Configuration&#x27; -&gt; &#x27;Policy management&#x27;. This time we&#x27;re going to import a policy into RHACS.</p><p>Select the <code>Import policy</code> button to bring up the import dialog.</p><div data-rmiz-wrap="visible"><div><img alt="runtime1" loading="lazy" width="1767" height="700" decoding="async" data-nimg="1" style="color:transparent" srcSet="https://workshop-936810110.imgix.net/static/images/exercise4/runtime1.png?auto=format&amp;fit=max&amp;w=1920 1x, https://workshop-936810110.imgix.net/static/images/exercise4/runtime1.png?auto=format&amp;fit=max&amp;w=3840 2x" src="https://workshop-936810110.imgix.net/static/images/exercise4/runtime1.png?auto=format&amp;fit=max&amp;w=3840"/></div><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div><div data-rmiz-wrap="visible"><div><img alt="runtime2" loading="lazy" width="1754" height="1201" decoding="async" data-nimg="1" style="color:transparent" srcSet="https://workshop-936810110.imgix.net/static/images/exercise4/runtime2.png?auto=format&amp;fit=max&amp;w=1920 1x, https://workshop-936810110.imgix.net/static/images/exercise4/runtime2.png?auto=format&amp;fit=max&amp;w=3840 2x" src="https://workshop-936810110.imgix.net/static/images/exercise4/runtime2.png?auto=format&amp;fit=max&amp;w=3840"/></div><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div><p>In the text-box, paste the following policy, replacing <code>%%replace-me%%</code> with your username:</p><div class="relative"><pre><code class="language-json code-highlight"><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property">&quot;policies&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-line">        <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Polkit Execution Detected - %%replace-me%%&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Detects execution of the pkexec binary in a container&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token property">&quot;rationale&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Polkit can be abused by attackers to elevate privileges within a container.&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token property">&quot;remediation&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Use your package manager&#x27;s \&quot;remove\&quot; command to remove polkit packages from the image build for production containers.&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token property">&quot;disabled&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token property">&quot;categories&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-line">                <span class="token string">&quot;Security Best Practices&quot;</span>
</span><span class="code-line">            <span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token property">&quot;lifecycleStages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-line">                <span class="token string">&quot;RUNTIME&quot;</span>
</span><span class="code-line">            <span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token property">&quot;eventSource&quot;</span><span class="token operator">:</span> <span class="token string">&quot;DEPLOYMENT_EVENT&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token property">&quot;exclusions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token property">&quot;scope&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token property">&quot;severity&quot;</span><span class="token operator">:</span> <span class="token string">&quot;MEDIUM_SEVERITY&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token property">&quot;enforcementActions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-line">                <span class="token string">&quot;KILL_POD_ENFORCEMENT&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">                <span class="token string">&quot;FAIL_KUBE_REQUEST_ENFORCEMENT&quot;</span>
</span><span class="code-line">            <span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token property">&quot;notifiers&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token property">&quot;SORTName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token property">&quot;SORTLifecycleStage&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token property">&quot;SORTEnforcement&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token property">&quot;policyVersion&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.1&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token property">&quot;policySections&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-line">                <span class="token punctuation">{</span>
</span><span class="code-line">                    <span class="token property">&quot;sectionName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">                    <span class="token property">&quot;policyGroups&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-line">                        <span class="token punctuation">{</span>
</span><span class="code-line">                            <span class="token property">&quot;fieldName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Process Name&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">                            <span class="token property">&quot;booleanOperator&quot;</span><span class="token operator">:</span> <span class="token string">&quot;OR&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">                            <span class="token property">&quot;negate&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
</span><span class="code-line">                            <span class="token property">&quot;values&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-line">                                <span class="token punctuation">{</span>
</span><span class="code-line">                                    <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pkexec&quot;</span>
</span><span class="code-line">                                <span class="token punctuation">}</span>
</span><span class="code-line">                            <span class="token punctuation">]</span>
</span><span class="code-line">                        <span class="token punctuation">}</span>
</span><span class="code-line">                    <span class="token punctuation">]</span>
</span><span class="code-line">                <span class="token punctuation">}</span>
</span><span class="code-line">            <span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token property">&quot;mitreAttackVectors&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token property">&quot;criteriaLocked&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token property">&quot;mitreVectorsLocked&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token property">&quot;isDefault&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">]</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>Select &#x27;Begin import&#x27;.</p><div data-rmiz-wrap="visible"><div><img alt="runtime3" loading="lazy" width="1746" height="1216" decoding="async" data-nimg="1" style="color:transparent" srcSet="https://workshop-936810110.imgix.net/static/images/exercise4/runtime3.png?auto=format&amp;fit=max&amp;w=1920 1x, https://workshop-936810110.imgix.net/static/images/exercise4/runtime3.png?auto=format&amp;fit=max&amp;w=3840 2x" src="https://workshop-936810110.imgix.net/static/images/exercise4/runtime3.png?auto=format&amp;fit=max&amp;w=3840"/></div><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div><p>Once the policy is imported you can search for &#x27;Policy: polkit&#x27; to see the new policy is enabled at runtime.</p><div data-rmiz-wrap="visible"><div><img alt="runtime4" loading="lazy" width="1777" height="750" decoding="async" data-nimg="1" style="color:transparent" srcSet="https://workshop-936810110.imgix.net/static/images/exercise4/runtime4.png?auto=format&amp;fit=max&amp;w=1920 1x, https://workshop-936810110.imgix.net/static/images/exercise4/runtime4.png?auto=format&amp;fit=max&amp;w=3840 2x" src="https://workshop-936810110.imgix.net/static/images/exercise4/runtime4.png?auto=format&amp;fit=max&amp;w=3840"/></div><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div><h2 id="trying-out-the-policy"><a href="#trying-out-the-policy" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Trying out the policy</h2><p>Now that this policy is enabled and enforcing, let&#x27;s try it out. Login to OpenShift and find the <code>backend</code> deployment in the <code>devops</code> namespace.</p><div data-rmiz-wrap="visible"><div><img alt="runtime5" loading="lazy" width="1775" height="1024" decoding="async" data-nimg="1" style="color:transparent" srcSet="https://workshop-936810110.imgix.net/static/images/exercise4/runtime5.png?auto=format&amp;fit=max&amp;w=1920 1x, https://workshop-936810110.imgix.net/static/images/exercise4/runtime5.png?auto=format&amp;fit=max&amp;w=3840 2x" src="https://workshop-936810110.imgix.net/static/images/exercise4/runtime5.png?auto=format&amp;fit=max&amp;w=3840"/></div><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div><p>Find the pod associated with this deployment and open a terminal session.</p><div data-rmiz-wrap="visible"><div><img alt="runtime6" loading="lazy" width="1762" height="821" decoding="async" data-nimg="1" style="color:transparent" srcSet="https://workshop-936810110.imgix.net/static/images/exercise4/runtime6.png?auto=format&amp;fit=max&amp;w=1920 1x, https://workshop-936810110.imgix.net/static/images/exercise4/runtime6.png?auto=format&amp;fit=max&amp;w=3840 2x" src="https://workshop-936810110.imgix.net/static/images/exercise4/runtime6.png?auto=format&amp;fit=max&amp;w=3840"/></div><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div><p>Try and run <code>pkexec</code> from the container. You should observe that the pod begins terminating:</p><div data-rmiz-wrap="visible"><div><img alt="runtime7" loading="lazy" width="1754" height="655" decoding="async" data-nimg="1" style="color:transparent" srcSet="https://workshop-936810110.imgix.net/static/images/exercise4/runtime7.png?auto=format&amp;fit=max&amp;w=1920 1x, https://workshop-936810110.imgix.net/static/images/exercise4/runtime7.png?auto=format&amp;fit=max&amp;w=3840 2x" src="https://workshop-936810110.imgix.net/static/images/exercise4/runtime7.png?auto=format&amp;fit=max&amp;w=3840"/></div><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div><p>Navigate back to Red Hat Advanced Cluster Security for Kubernetes (RHACS) and select &#x27;Violations&#x27;. Here you can see a new violation has been created for the <code>PolKit Execution Detected</code> policy.</p><div data-rmiz-wrap="visible"><div><img alt="runtime8" loading="lazy" width="1752" height="840" decoding="async" data-nimg="1" style="color:transparent" srcSet="https://workshop-936810110.imgix.net/static/images/exercise4/runtime8.png?auto=format&amp;fit=max&amp;w=1920 1x, https://workshop-936810110.imgix.net/static/images/exercise4/runtime8.png?auto=format&amp;fit=max&amp;w=3840 2x" src="https://workshop-936810110.imgix.net/static/images/exercise4/runtime8.png?auto=format&amp;fit=max&amp;w=3840"/></div><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div><p>If you dig into this violation you can see the activity that was generated in the container. In this case, the binary <code>/usr/bin/pkexec</code> was executed with no arguments.</p><div data-rmiz-wrap="visible"><div><img alt="runtime9" loading="lazy" width="1765" height="853" decoding="async" data-nimg="1" style="color:transparent" srcSet="https://workshop-936810110.imgix.net/static/images/exercise4/runtime9.png?auto=format&amp;fit=max&amp;w=1920 1x, https://workshop-936810110.imgix.net/static/images/exercise4/runtime9.png?auto=format&amp;fit=max&amp;w=3840 2x" src="https://workshop-936810110.imgix.net/static/images/exercise4/runtime9.png?auto=format&amp;fit=max&amp;w=3840"/></div><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div><p>The violation also shows the enforcement activity that took place. In this case, Red Hat Advanced Cluster Security for Kubernetes (RHACS) detected <code>pkexec</code> usage and immediately destroyed the running container, mitigating any attacker-controlled processes.</p><div data-rmiz-wrap="visible"><div><img alt="runtime10" loading="lazy" width="1784" height="796" decoding="async" data-nimg="1" style="color:transparent" srcSet="https://workshop-936810110.imgix.net/static/images/exercise4/runtime10.png?auto=format&amp;fit=max&amp;w=1920 1x, https://workshop-936810110.imgix.net/static/images/exercise4/runtime10.png?auto=format&amp;fit=max&amp;w=3840 2x" src="https://workshop-936810110.imgix.net/static/images/exercise4/runtime10.png?auto=format&amp;fit=max&amp;w=3840"/></div><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div><p>You can also see the policy that triggered this violation. In this case, it was the <code>PolKit Execution Detected</code> policy.</p><div data-rmiz-wrap="visible"><div><img alt="runtime11" loading="lazy" width="1760" height="868" decoding="async" data-nimg="1" style="color:transparent" srcSet="https://workshop-936810110.imgix.net/static/images/exercise4/runtime11.png?auto=format&amp;fit=max&amp;w=1920 1x, https://workshop-936810110.imgix.net/static/images/exercise4/runtime11.png?auto=format&amp;fit=max&amp;w=3840 2x" src="https://workshop-936810110.imgix.net/static/images/exercise4/runtime11.png?auto=format&amp;fit=max&amp;w=3840"/></div><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div><h2 id="summary"><a href="#summary" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Summary</h2><p>In this exercise we looked at identifying unauthorized process activity at runtime. Specifically, we used the Red Hat Advanced Cluster Security for Kubernetes (RHACS) eBPF probe to identify <code>pkexec</code> activity at runtime, and immediately respond and create violations for this activity.</p><p>Ideally we could also block workloads containing the <code>pkexec</code> binary or <code>polkit</code> package from OpenShift, using the RHACS admission controller as we saw in exercise 3. This might not be possible in all scenarios though - you might have third-party applications that contain the polkit package, or legacy workloads that can&#x27;t be modified. In these situations, Red Hat Advanced Cluster Security for Kubernetes (RHACS) provides the flexibility to allow these workloads to be deployed, while constraining process activity / network traffic.</p><h2 id="stretch-goals"><a href="#stretch-goals" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Stretch goals</h2><p>Can you lock-down the application, so that <em>nothing</em> run except for the <code>/bin/sleep</code> process?</p><ul><li>How can you identify the process baseline for an application? (Hint: take a look at the <code>Risk</code> tab in Red Hat Advanced Cluster Security for Kubernetes (RHACS))</li><li>How can you <strong>lock</strong> the process baseline for a deployment?</li><li>How do you notify security teams / take action when anomalous processes are detected inside running containers? (Hint: is there an existing policy for <code>Unauthorized process</code> execution?)</li></ul></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a href="/acs-intro-workshop/tags/runtime"><a class="mr-3 text-sm font-medium uppercase text-primary-800 hover:text-primary-900 dark:hover:text-primary-400">runtime</a></a><a href="/acs-intro-workshop/tags/unauthorized"><a class="mr-3 text-sm font-medium uppercase text-primary-800 hover:text-primary-900 dark:hover:text-primary-400">unauthorized</a></a><a href="/acs-intro-workshop/tags/openshift"><a class="mr-3 text-sm font-medium uppercase text-primary-800 hover:text-primary-900 dark:hover:text-primary-400">openshift</a></a><a href="/acs-intro-workshop/tags/rhacs"><a class="mr-3 text-sm font-medium uppercase text-primary-800 hover:text-primary-900 dark:hover:text-primary-400">rhacs</a></a><a href="/acs-intro-workshop/tags/ebpf"><a class="mr-3 text-sm font-medium uppercase text-primary-800 hover:text-primary-900 dark:hover:text-primary-400">ebpf</a></a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Exercise</h2><div class="text-primary-800 hover:text-primary-900 dark:hover:text-primary-400"><a href="/acs-intro-workshop/workshop/exercise3"><a>Blocking vulnerable workloads from OpenShift</a></a></div></div></div></div><div class="pt-4 xl:pt-8"><a href="/acs-intro-workshop/workshop"><a class="text-primary-800 hover:text-primary-900 dark:hover:text-primary-400">← Back to the exercise list</a></a></div></footer></div></div></article></div></main><footer><div class="flex flex-col items-center mt-16"><div class="flex mb-2 space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>© 2024</div><div> • </div><a href="/acs-intro-workshop"><a>Red Hat</a></a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var h=Object.create;var r=Object.defineProperty;var m=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var N=Object.getPrototypeOf,k=Object.prototype.hasOwnProperty;var o=a=\u003er(a,\"__esModule\",{value:!0});var g=(a,i)=\u003e()=\u003e(i||a((i={exports:{}}).exports,i),i.exports),y=(a,i)=\u003e{o(a);for(var c in i)r(a,c,{get:i[c],enumerable:!0})},f=(a,i,c)=\u003e{if(i\u0026\u0026typeof i==\"object\"||typeof i==\"function\")for(let n of u(i))!k.call(a,n)\u0026\u0026n!==\"default\"\u0026\u0026r(a,n,{get:()=\u003ei[n],enumerable:!(c=m(i,n))||c.enumerable});return a},b=a=\u003ef(o(r(a!=null?h(N(a)):{},\"default\",a\u0026\u0026a.__esModule\u0026\u0026\"default\"in a?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a);var d=g((C,l)=\u003e{l.exports=_jsx_runtime});var S={};y(S,{default:()=\u003ex,frontmatter:()=\u003ev});var e=b(d()),v={title:\"Detecting unauthorized application behaviour at runtime with RHACS\",exercise:4,date:\"2024-06-04\",tags:[\"runtime\",\"unauthorized\",\"openshift\",\"rhacs\",\"ebpf\"],draft:!1,authors:[\"default\"],summary:\"In this exercise we'll identify and block unauthorized behaviours in container applications at runtime.\"};function w(a={}){let{wrapper:i}=a.components||{};return i?(0,e.jsx)(i,Object.assign({},a,{children:(0,e.jsx)(c,{})})):c();function c(){let n=Object.assign({p:\"p\",ul:\"ul\",li:\"li\",code:\"code\",h2:\"h2\",a:\"a\",span:\"span\",div:\"div\",pre:\"pre\",em:\"em\",strong:\"strong\"},a.components),{Zoom:t,Image:s}=n;return s||p(\"Image\",!0),t||p(\"Zoom\",!0),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(n.p,{children:\"Throughout this workshop we've looked at 'PwnKit', a vulnerability in the PolKit package potentially allowing privileged escalation. So far we've looked at:\"}),(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:\"Analyzing container images for CVEs, and identifying vulnerable OpenShift workloads\"}),(0,e.jsx)(n.li,{children:\"Running a campaign for PwnKit-vulnerable container images and deployments\"}),(0,e.jsx)(n.li,{children:\"Blocking container images vulnerable to PwnKit from being deployed to OpenShift\"})]}),(0,e.jsxs)(n.p,{children:[\"One of the critical requirements to exploit PwnKit is that users can interactively run \",(0,e.jsx)(n.code,{children:\"pkexec\"}),\" from a container. In this lab, we'll look at detecting and preventing \",(0,e.jsx)(n.code,{children:\"pkexec\"}),\" usage from within containers, mitigating PwnKit exploitation.\"]}),(0,e.jsxs)(n.h2,{id:\"red-hat-advanced-cluster-security-for-kubernetes-rhacs-runtime-security\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#red-hat-advanced-cluster-security-for-kubernetes-rhacs-runtime-security\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Red Hat Advanced Cluster Security for Kubernetes (RHACS) runtime security\"]}),(0,e.jsx)(n.p,{children:\"Historically, the operating system has always been an ideal place to implement observability, security, and networking functionality due to the kernel\\u2019s privileged ability to oversee and control the entire system. At the same time, an operating system kernel is hard to evolve due to its central role and high requirement towards stability and security. The rate of innovation at the operating system level has thus traditionally been lower compared to functionality implemented outside of the operating system.\"}),(0,e.jsx)(n.p,{children:\"The extended Berkeley Packet Filter (eBPF) changes this formula fundamentally. It allows sandboxed programs to run within the operating system, which means that application developers can run eBPF programs to add additional capabilities to the operating system at runtime. The operating system then guarantees safety and execution efficiency as if natively compiled with the aid of a Just-In-Time (JIT) compiler and verification engine. This has led to a wave of eBPF-based projects covering a wide array of use cases, including next-generation networking, observability, and security functionality.\"}),(0,e.jsx)(n.p,{children:\"Today, eBPF is used extensively to drive a wide variety of use cases: Providing high-performance networking and load-balancing in modern data centers and cloud native environments, extracting fine-grained security observability data at low overhead, helping application developers trace applications, providing insights for performance troubleshooting, preventive application and container runtime security enforcement, and much more. The possibilities are endless, and the innovation that eBPF is unlocking has only just begun.\"}),(0,e.jsx)(n.p,{children:\"Red Hat Advanced Cluster Security for Kubernetes (RHACS) uses an eBPF probe to detect processes running in containers, and also detect container network traffic flows. The eBPF probe runs on every Red Hat Enterprise Linux CoreOS (RHCOS) node of an OpenShift cluster.\"}),(0,e.jsxs)(n.h2,{id:\"detecting-pkexec-in-containers\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#detecting-pkexec-in-containers\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Detecting pkexec in containers\"]}),(0,e.jsxs)(n.p,{children:[\"Our goal in this lab is to detect and prevent the \",(0,e.jsx)(n.code,{children:\"pkexec\"}),\" binary being used in containers. To do this, we can implement a runtime policy in Red Hat Advanced Cluster Security for Kubernetes (RHACS).\"]}),(0,e.jsx)(n.p,{children:\"Navigate to 'Platform Configuration' -\u003e 'Policy management'. This time we're going to import a policy into RHACS.\"}),(0,e.jsxs)(n.p,{children:[\"Select the \",(0,e.jsx)(n.code,{children:\"Import policy\"}),\" button to bring up the import dialog.\"]}),(0,e.jsx)(t,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(s,{alt:\"runtime1\",src:\"/static/images/exercise4/runtime1.png\",width:\"1767\",height:\"700\"})})}),(0,e.jsx)(t,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(s,{alt:\"runtime2\",src:\"/static/images/exercise4/runtime2.png\",width:\"1754\",height:\"1201\"})})}),(0,e.jsxs)(n.p,{children:[\"In the text-box, paste the following policy, replacing \",(0,e.jsx)(n.code,{children:\"%%replace-me%%\"}),\" with your username:\"]}),(0,e.jsx)(n.pre,{className:\"language-json\",children:(0,e.jsxs)(n.code,{className:\"language-json code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"policies\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"name\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Polkit Execution Detected - %%replace-me%%\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"description\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Detects execution of the pkexec binary in a container\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"rationale\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Polkit can be abused by attackers to elevate privileges within a container.\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"remediation\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:`\"Use your package manager's \\\\\"remove\\\\\" command to remove polkit packages from the image build for production containers.\"`}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"disabled\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"false\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"categories\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Security Best Practices\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"lifecycleStages\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"RUNTIME\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"eventSource\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"DEPLOYMENT_EVENT\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"exclusions\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"scope\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"severity\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"MEDIUM_SEVERITY\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"enforcementActions\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"KILL_POD_ENFORCEMENT\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"FAIL_KUBE_REQUEST_ENFORCEMENT\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"notifiers\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"SORTName\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"SORTLifecycleStage\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"SORTEnforcement\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"false\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"policyVersion\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"1.1\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"policySections\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"sectionName\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"policyGroups\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                            \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"fieldName\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Process Name\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                            \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"booleanOperator\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"OR\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                            \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"negate\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"false\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                            \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"values\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                                \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                                    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"value\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"pkexec\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                                \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"mitreAttackVectors\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"criteriaLocked\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"false\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"mitreVectorsLocked\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"false\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"isDefault\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"false\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"Select 'Begin import'.\"}),(0,e.jsx)(t,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(s,{alt:\"runtime3\",src:\"/static/images/exercise4/runtime3.png\",width:\"1746\",height:\"1216\"})})}),(0,e.jsx)(n.p,{children:\"Once the policy is imported you can search for 'Policy: polkit' to see the new policy is enabled at runtime.\"}),(0,e.jsx)(t,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(s,{alt:\"runtime4\",src:\"/static/images/exercise4/runtime4.png\",width:\"1777\",height:\"750\"})})}),(0,e.jsxs)(n.h2,{id:\"trying-out-the-policy\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#trying-out-the-policy\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Trying out the policy\"]}),(0,e.jsxs)(n.p,{children:[\"Now that this policy is enabled and enforcing, let's try it out. Login to OpenShift and find the \",(0,e.jsx)(n.code,{children:\"backend\"}),\" deployment in the \",(0,e.jsx)(n.code,{children:\"devops\"}),\" namespace.\"]}),(0,e.jsx)(t,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(s,{alt:\"runtime5\",src:\"/static/images/exercise4/runtime5.png\",width:\"1775\",height:\"1024\"})})}),(0,e.jsx)(n.p,{children:\"Find the pod associated with this deployment and open a terminal session.\"}),(0,e.jsx)(t,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(s,{alt:\"runtime6\",src:\"/static/images/exercise4/runtime6.png\",width:\"1762\",height:\"821\"})})}),(0,e.jsxs)(n.p,{children:[\"Try and run \",(0,e.jsx)(n.code,{children:\"pkexec\"}),\" from the container. You should observe that the pod begins terminating:\"]}),(0,e.jsx)(t,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(s,{alt:\"runtime7\",src:\"/static/images/exercise4/runtime7.png\",width:\"1754\",height:\"655\"})})}),(0,e.jsxs)(n.p,{children:[\"Navigate back to Red Hat Advanced Cluster Security for Kubernetes (RHACS) and select 'Violations'. Here you can see a new violation has been created for the \",(0,e.jsx)(n.code,{children:\"PolKit Execution Detected\"}),\" policy.\"]}),(0,e.jsx)(t,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(s,{alt:\"runtime8\",src:\"/static/images/exercise4/runtime8.png\",width:\"1752\",height:\"840\"})})}),(0,e.jsxs)(n.p,{children:[\"If you dig into this violation you can see the activity that was generated in the container. In this case, the binary \",(0,e.jsx)(n.code,{children:\"/usr/bin/pkexec\"}),\" was executed with no arguments.\"]}),(0,e.jsx)(t,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(s,{alt:\"runtime9\",src:\"/static/images/exercise4/runtime9.png\",width:\"1765\",height:\"853\"})})}),(0,e.jsxs)(n.p,{children:[\"The violation also shows the enforcement activity that took place. In this case, Red Hat Advanced Cluster Security for Kubernetes (RHACS) detected \",(0,e.jsx)(n.code,{children:\"pkexec\"}),\" usage and immediately destroyed the running container, mitigating any attacker-controlled processes.\"]}),(0,e.jsx)(t,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(s,{alt:\"runtime10\",src:\"/static/images/exercise4/runtime10.png\",width:\"1784\",height:\"796\"})})}),(0,e.jsxs)(n.p,{children:[\"You can also see the policy that triggered this violation. In this case, it was the \",(0,e.jsx)(n.code,{children:\"PolKit Execution Detected\"}),\" policy.\"]}),(0,e.jsx)(t,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(s,{alt:\"runtime11\",src:\"/static/images/exercise4/runtime11.png\",width:\"1760\",height:\"868\"})})}),(0,e.jsxs)(n.h2,{id:\"summary\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#summary\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Summary\"]}),(0,e.jsxs)(n.p,{children:[\"In this exercise we looked at identifying unauthorized process activity at runtime. Specifically, we used the Red Hat Advanced Cluster Security for Kubernetes (RHACS) eBPF probe to identify \",(0,e.jsx)(n.code,{children:\"pkexec\"}),\" activity at runtime, and immediately respond and create violations for this activity.\"]}),(0,e.jsxs)(n.p,{children:[\"Ideally we could also block workloads containing the \",(0,e.jsx)(n.code,{children:\"pkexec\"}),\" binary or \",(0,e.jsx)(n.code,{children:\"polkit\"}),\" package from OpenShift, using the RHACS admission controller as we saw in exercise 3. This might not be possible in all scenarios though - you might have third-party applications that contain the polkit package, or legacy workloads that can't be modified. In these situations, Red Hat Advanced Cluster Security for Kubernetes (RHACS) provides the flexibility to allow these workloads to be deployed, while constraining process activity / network traffic.\"]}),(0,e.jsxs)(n.h2,{id:\"stretch-goals\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#stretch-goals\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Stretch goals\"]}),(0,e.jsxs)(n.p,{children:[\"Can you lock-down the application, so that \",(0,e.jsx)(n.em,{children:\"nothing\"}),\" run except for the \",(0,e.jsx)(n.code,{children:\"/bin/sleep\"}),\" process?\"]}),(0,e.jsxs)(n.ul,{children:[(0,e.jsxs)(n.li,{children:[\"How can you identify the process baseline for an application? (Hint: take a look at the \",(0,e.jsx)(n.code,{children:\"Risk\"}),\" tab in Red Hat Advanced Cluster Security for Kubernetes (RHACS))\"]}),(0,e.jsxs)(n.li,{children:[\"How can you \",(0,e.jsx)(n.strong,{children:\"lock\"}),\" the process baseline for a deployment?\"]}),(0,e.jsxs)(n.li,{children:[\"How do you notify security teams / take action when anomalous processes are detected inside running containers? (Hint: is there an existing policy for \",(0,e.jsx)(n.code,{children:\"Unauthorized process\"}),\" execution?)\"]})]})]})}}var x=w;function p(a,i){throw new Error(\"Expected \"+(i?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return S;})();\n;return Component;","toc":[{"value":"Red Hat Advanced Cluster Security for Kubernetes (RHACS) runtime security","url":"#red-hat-advanced-cluster-security-for-kubernetes-rhacs-runtime-security","depth":2},{"value":"Detecting pkexec in containers","url":"#detecting-pkexec-in-containers","depth":2},{"value":"Trying out the policy","url":"#trying-out-the-policy","depth":2},{"value":"Summary","url":"#summary","depth":2},{"value":"Stretch goals","url":"#stretch-goals","depth":2}],"frontMatter":{"readingTime":{"text":"6 min read","minutes":5.985,"time":359100,"words":1197},"slug":"exercise4","fileName":"exercise4.mdx","title":"Detecting unauthorized application behaviour at runtime with RHACS","exercise":4,"date":"2024-06-04T00:00:00.000Z","tags":["runtime","unauthorized","openshift","rhacs","ebpf"],"draft":false,"authors":["default"],"summary":"In this exercise we'll identify and block unauthorized behaviours in container applications at runtime."}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.24,"time":14400,"words":48},"slug":["default"],"fileName":"default.md","date":null}],"prev":{"title":"Blocking vulnerable workloads from OpenShift","exercise":3,"date":"2024-06-03T00:00:00.000Z","tags":["admission","control","openshift","rhacs","cve"],"draft":false,"authors":["default"],"summary":"In the third exercise we'll block vulnerable container images from OpenShift","slug":"exercise3"},"next":null},"__N_SSG":true},"page":"/workshop/[...slug]","query":{"slug":["exercise4"]},"buildId":"3OTyFijNBoIsio-CpMbkl","assetPrefix":"/acs-intro-workshop","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>