<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><title>Blocking vulnerable workloads from OpenShift</title><meta name="robots" content="follow, index"/><meta name="description" content="In the third exercise we&#x27;ll block vulnerable container images from OpenShift"/><meta property="og:url" content="https://tssc.blueradish.net/workshop/exercise3"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Red Hat Advanced Cluster Security for Kubernetes Workshop"/><meta property="og:description" content="In the third exercise we&#x27;ll block vulnerable container images from OpenShift"/><meta property="og:title" content="Blocking vulnerable workloads from OpenShift"/><meta property="og:image" content="https://tssc.blueradish.net/static/images/twitter-card.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="https://twitter.com/shaneboulden"/><meta name="twitter:title" content="Blocking vulnerable workloads from OpenShift"/><meta name="twitter:description" content="In the third exercise we&#x27;ll block vulnerable container images from OpenShift"/><meta name="twitter:image" content="https://tssc.blueradish.net/static/images/twitter-card.png"/><meta property="article:published_time" content="2024-06-03T00:00:00.000Z"/><link rel="canonical" href="https://tssc.blueradish.net/workshop/exercise3"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://tssc.blueradish.net/workshop/exercise3"
  },
  "headline": "Blocking vulnerable workloads from OpenShift",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://tssc.blueradish.net/static/images/twitter-card.png"
    }
  ],
  "datePublished": "2024-06-03T00:00:00.000Z",
  "dateModified": "2024-06-03T00:00:00.000Z",
  "author": [
    {
      "@type": "Person"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Red Hat",
    "logo": {
      "@type": "ImageObject",
      "url": "https://tssc.blueradish.net/static/images/redhat.png"
    }
  },
  "description": "In the third exercise we'll block vulnerable container images from OpenShift"
}</script><meta name="next-head-count" content="20"/><link rel="apple-touch-icon" sizes="180x180" href="/static/favicons/apple-touch-icon.png?v=2"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png?v=2"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png?v=2"/><link rel="manifest" href="/static/favicons/site.webmanifest?v=2"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg?v=2" color="#5bbad5"/><link rel="shortcut icon" href="/static/favicons/favicon.ico?v=2"/><meta name="msapplication-TileColor" content="#2b5797"/><meta name="msapplication-config" content="/static/favicons/browserconfig.xml?v=2"/><meta name="theme-color" content="#ffffff"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link data-next-font="" rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/acs-intro-workshop/_next/static/css/c765b2071639cad1.css" as="style"/><link rel="stylesheet" href="/acs-intro-workshop/_next/static/css/c765b2071639cad1.css" data-n-g=""/><link rel="preload" href="/acs-intro-workshop/_next/static/css/6d530d6069fd563f.css" as="style"/><link rel="stylesheet" href="/acs-intro-workshop/_next/static/css/6d530d6069fd563f.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/acs-intro-workshop/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js"></script><script src="/acs-intro-workshop/_next/static/chunks/webpack-f0964fa994f7d701.js" defer=""></script><script src="/acs-intro-workshop/_next/static/chunks/main-4fbf6d6e3e7f89e9.js" defer=""></script><script src="/acs-intro-workshop/_next/static/chunks/pages/_app-66c35ca7b372edd1.js" defer=""></script><script src="/acs-intro-workshop/_next/static/chunks/675-ab1c32210a69eebe.js" defer=""></script><script src="/acs-intro-workshop/_next/static/chunks/329-981c399b42fc6a71.js" defer=""></script><script src="/acs-intro-workshop/_next/static/chunks/782-2f60569a5ccbcc66.js" defer=""></script><script src="/acs-intro-workshop/_next/static/chunks/pages/workshop/%5B...slug%5D-9c81ff1983fad6aa.js" defer=""></script><script src="/acs-intro-workshop/_next/static/8cbUt7puzyI2HzQphIGdu/_buildManifest.js" defer=""></script><script src="/acs-intro-workshop/_next/static/8cbUt7puzyI2HzQphIGdu/_ssgManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap">@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuGKYMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuFuYMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body class="antialiased text-black bg-white dark:bg-gray-900 dark:text-white"><div id="__next"><div class="max-w-3xl px-4 mx-auto sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex flex-col justify-between h-screen"><header class="flex items-center justify-between py-10"><div><a href="/acs-intro-workshop"><a aria-label="Tailwind CSS Blog"><div class="flex items-center justify-between"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 228 228" width="39" height="30" style="enable-background:new 0 0 228 228" xml:space="preserve"><path d="M187.9 100.6c.3 1.3.4 2.7.4 4.1 0 17.7-21.5 20.7-36.3 20.7-57.8 0-100.8-35.9-100.8-46.8 0-.7 0-1.5.3-2.3L47 87c-1 2.3-1.8 5.4-1.8 8.7 0 21.5 48.6 54 104.2 54 24.6 0 43.3-9.2 43.3-25.9 0-1.3 0-2.3-2-12l-2.8-11.2z"></path><path d="M151.9 125.4c14.8 0 36.3-3.1 36.3-20.7 0-1.4 0-2.7-.4-4.1L179 62.2c-2.1-8.4-3.8-12.3-18.7-19.7-11.5-5.9-36.6-15.6-44-15.6-6.9 0-9 9-17.1 9-7.9 0-13.8-6.7-21.2-6.7-7.2 0-11.8 4.9-15.4 14.8 0 0-10 28.2-11.3 32.2-.3.8-.3 1.6-.3 2.3.1 11 43.2 46.9 100.9 46.9m38.7-13.5c2 9.7 2 10.7 2 12 0 16.6-18.7 25.9-43.3 25.9-55.5 0-104.2-32.5-104.2-54 0-3.3.8-6.4 1.8-8.7-20 1-45.8 4.6-45.8 27.4 0 37.4 88.6 83.4 158.7 83.4 53.8 0 67.3-24.3 67.3-43.5.1-15.1-13-32.3-36.5-42.5" style="fill:#e00"></path></svg></div><div class="hidden h-6 text-2xl font-semibold sm:block">Red Hat</div></div></a></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a href="/acs-intro-workshop/workshop"><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100">Exercises</a></a><a target="_blank" rel="noopener noreferrer" href="https://etherpad.wikimedia.org/p/rhacs-workshop-june-2024" class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100">Etherpad</a></div><button aria-label="Toggle Dark Mode" type="button" class="w-8 h-8 p-1 ml-1 mr-1 rounded sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="w-8 h-8 ml-1 mr-1 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed w-full h-full top-24 right-0 bg-gray-200 dark:bg-gray-800 opacity-95 z-10 transform ease-in-out duration-300 translate-x-full"><button type="button" aria-label="toggle modal" class="fixed w-full h-full cursor-auto focus:outline-none"></button><nav class="fixed h-full mt-8"><div class="px-12 py-4"><a href="/acs-intro-workshop/workshop"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100">Exercises</a></a></div><div class="px-12 py-4"><a target="_blank" rel="noopener noreferrer" href="https://etherpad.wikimedia.org/p/rhacs-workshop-june-2024" class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100">Etherpad</a></div></nav></div></div></div></header><main class="mb-auto"><div class="max-w-3xl px-4 mx-auto sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400">Exercise <!-- -->3</dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Blocking vulnerable workloads from OpenShift</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100"></dd><dt class="sr-only">Twitter</dt><dd></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><p>So far we&#x27;ve looked at analysing CVEs that are exposed on OpenShift. We&#x27;ve looked at how to identify vulnerable container images, and how to create campaigns and generate data for specific high-interest CVEs.</p><p>But how did those CVEs get there in the first place? What if we could identify CVEs <em>before</em> they become running code on the platform?</p><p>Red Hat Advanced Cluster Security for Kubernetes (RHACS) supports a couple of ways of identifying / managing CVEs before they make it to OpenShift:</p><ul><li><p><strong>Integrating CVE scanning into CI/CD pipelines.</strong> Red Hat Advanced Cluster Security for Kubernetes (RHACS) supports the <code>roxctl</code> CLI, a portable binary that can be used to inject CVE scanning into any pipeline or development process.</p></li><li><p><strong>Admission control</strong> Red Hat Advanced Cluster Security for Kubernetes (RHACS) pushes down a Kubernetes admission controller to secured OpenShift clusters. This means we can make decisions about allowing / blocking vulnerable workloads before they are accepted to the cluster.</p></li></ul><details><summary><strong>What is Kubernetes admission control?</strong></summary> <p>An admission controller is a piece of code that intercepts requests to the Kubernetes API server prior to persistence of the object, but after the request is authenticated and authorized.</p><p>Admission controllers limit requests to create, delete, modify objects. Admission controllers can also block custom verbs, such as a request connect to a Pod via an API server proxy. Admission controllers do not (and cannot) block requests to read (get, watch or list) objects.</p><p>Red Hat Advanced Cluster Security for Kubernetes (RHACS) deploys a Kubernetes admission controller to secured clusters that can be used to validate applications for vulnerabilities or misconfiguration before being deployed to the cluster.</p></details><h2 id="using-the-rhacs-admission-controller"><a href="#using-the-rhacs-admission-controller" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Using the RHACS admission controller</h2><p>Let&#x27;s take a closer look at the Red Hat Advanced Cluster Security for Kubernetes (RHACS) admission controller. In the previous exercise we created a policy for PwnKit, which we used to report on vulnerable workloads.</p><div data-rmiz-wrap="visible"><div><img alt="adm1" loading="lazy" width="1720" height="1105" decoding="async" data-nimg="1" style="color:transparent" srcSet="https://workshop-936810110.imgix.net/static/images/exercise3/adm1.png?auto=format&amp;fit=max&amp;w=1920 1x, https://workshop-936810110.imgix.net/static/images/exercise3/adm1.png?auto=format&amp;fit=max&amp;w=3840 2x" src="https://workshop-936810110.imgix.net/static/images/exercise3/adm1.png?auto=format&amp;fit=max&amp;w=3840"/></div><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div><p>We&#x27;re going to re-use this same policy to now <strong>block</strong> vulnerable container images from OpenShift. To get started, navigate to <code>Platform Configuration</code> -&gt; <code>Policy Management</code>. Perform a search for <code>pwnkit</code>, and find the policy for your user.</p><div data-rmiz-wrap="visible"><div><img alt="adm2" loading="lazy" width="1756" height="845" decoding="async" data-nimg="1" style="color:transparent" srcSet="https://workshop-936810110.imgix.net/static/images/exercise3/adm2.png?auto=format&amp;fit=max&amp;w=1920 1x, https://workshop-936810110.imgix.net/static/images/exercise3/adm2.png?auto=format&amp;fit=max&amp;w=3840 2x" src="https://workshop-936810110.imgix.net/static/images/exercise3/adm2.png?auto=format&amp;fit=max&amp;w=3840"/></div><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div><p>Select &#x27;Edit policy&#x27; from the &#x27;kebab&#x27; menu on the right.</p><div data-rmiz-wrap="visible"><div><img alt="adm3" loading="lazy" width="1748" height="880" decoding="async" data-nimg="1" style="color:transparent" srcSet="https://workshop-936810110.imgix.net/static/images/exercise3/adm3.png?auto=format&amp;fit=max&amp;w=1920 1x, https://workshop-936810110.imgix.net/static/images/exercise3/adm3.png?auto=format&amp;fit=max&amp;w=3840 2x" src="https://workshop-936810110.imgix.net/static/images/exercise3/adm3.png?auto=format&amp;fit=max&amp;w=3840"/></div><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div><p>There&#x27;s no changes we need to make to the policy details, so let&#x27;s click &#x27;Next&#x27; on the first screen.</p><div data-rmiz-wrap="visible"><div><img alt="adm4" loading="lazy" width="1723" height="995" decoding="async" data-nimg="1" style="color:transparent" srcSet="https://workshop-936810110.imgix.net/static/images/exercise3/adm4.png?auto=format&amp;fit=max&amp;w=1920 1x, https://workshop-936810110.imgix.net/static/images/exercise3/adm4.png?auto=format&amp;fit=max&amp;w=3840 2x" src="https://workshop-936810110.imgix.net/static/images/exercise3/adm4.png?auto=format&amp;fit=max&amp;w=3840"/></div><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div><p>We are going to make some changes to the &#x27;Policy behavior&#x27; section. Change the &#x27;Response method&#x27; from &#x27;Inform&#x27; to &#x27;Inform and enforce&#x27;, and ensure that the toggle for &#x27;Deploy&#x27; is switched to &#x27;Enforce on Deploy&#x27;.</p><div data-rmiz-wrap="visible"><div><img alt="adm5" loading="lazy" width="1726" height="1129" decoding="async" data-nimg="1" style="color:transparent" srcSet="https://workshop-936810110.imgix.net/static/images/exercise3/adm5.png?auto=format&amp;fit=max&amp;w=1920 1x, https://workshop-936810110.imgix.net/static/images/exercise3/adm5.png?auto=format&amp;fit=max&amp;w=3840 2x" src="https://workshop-936810110.imgix.net/static/images/exercise3/adm5.png?auto=format&amp;fit=max&amp;w=3840"/></div><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div><p>This means that our policy will now block any workloads vulnerable to PwnKit, whenever we try to create a new deployment or update an existing deployment. Great!</p><p>Click next to continue to the policy criteria. There&#x27;s no other changes we need to make here, so just click &#x27;Next&#x27;.</p><div data-rmiz-wrap="visible"><div><img alt="adm6" loading="lazy" width="1748" height="687" decoding="async" data-nimg="1" style="color:transparent" srcSet="https://workshop-936810110.imgix.net/static/images/exercise3/adm6.png?auto=format&amp;fit=max&amp;w=1920 1x, https://workshop-936810110.imgix.net/static/images/exercise3/adm6.png?auto=format&amp;fit=max&amp;w=3840 2x" src="https://workshop-936810110.imgix.net/static/images/exercise3/adm6.png?auto=format&amp;fit=max&amp;w=3840"/></div><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div><p>We&#x27;re going to add an inclusive scope for this policy, so that it only targets each users&#x27; namespace. Next to &#x27;Restrict by scope&#x27; click the <code>Add inclusion scope</code> button.</p><div data-rmiz-wrap="visible"><div><img alt="adm7" loading="lazy" width="1738" height="1090" decoding="async" data-nimg="1" style="color:transparent" srcSet="https://workshop-936810110.imgix.net/static/images/exercise3/adm7.png?auto=format&amp;fit=max&amp;w=1920 1x, https://workshop-936810110.imgix.net/static/images/exercise3/adm7.png?auto=format&amp;fit=max&amp;w=3840 2x" src="https://workshop-936810110.imgix.net/static/images/exercise3/adm7.png?auto=format&amp;fit=max&amp;w=3840"/></div><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div><p>Select <code>openshift</code> from the &#x27;Cluster&#x27; drop-down, and enter your workshop username for the &#x27;Namespace&#x27;. The inclusive scope should look like this:</p><div data-rmiz-wrap="visible"><div><img alt="adm8" loading="lazy" width="1711" height="885" decoding="async" data-nimg="1" style="color:transparent" srcSet="https://workshop-936810110.imgix.net/static/images/exercise3/adm8.png?auto=format&amp;fit=max&amp;w=1920 1x, https://workshop-936810110.imgix.net/static/images/exercise3/adm8.png?auto=format&amp;fit=max&amp;w=3840 2x" src="https://workshop-936810110.imgix.net/static/images/exercise3/adm8.png?auto=format&amp;fit=max&amp;w=3840"/></div><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div><p>Select &#x27;Next&#x27; and review the policy. You should check that the &#x27;Policy behaviour&#x27; is set to &#x27;Deploy&#x27; for Enforcement, and that there is an inclusive policy scope defined.</p><div data-rmiz-wrap="visible"><div><img alt="adm9" loading="lazy" width="1540" height="1238" decoding="async" data-nimg="1" style="color:transparent" srcSet="https://workshop-936810110.imgix.net/static/images/exercise3/adm9.png?auto=format&amp;fit=max&amp;w=1920 1x, https://workshop-936810110.imgix.net/static/images/exercise3/adm9.png?auto=format&amp;fit=max&amp;w=3840 2x" src="https://workshop-936810110.imgix.net/static/images/exercise3/adm9.png?auto=format&amp;fit=max&amp;w=3840"/></div><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div><p>When you&#x27;re happy, click &#x27;Save&#x27;.</p><h2 id="trying-out-the-new-policy"><a href="#trying-out-the-new-policy" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Trying out the new policy</h2><p>Let&#x27;s try out the new policy for PwnKit and make sure that blocks vulnerable container images.</p><p>Login to OpenShift and navigate to your individual project. Select the <code>+</code> in the top-right corner of OpenShift to create a new deployment.</p><div data-rmiz-wrap="visible"><div><img alt="adm10" loading="lazy" width="1566" height="959" decoding="async" data-nimg="1" style="color:transparent" srcSet="https://workshop-936810110.imgix.net/static/images/exercise3/adm10.png?auto=format&amp;fit=max&amp;w=1920 1x, https://workshop-936810110.imgix.net/static/images/exercise3/adm10.png?auto=format&amp;fit=max&amp;w=3840 2x" src="https://workshop-936810110.imgix.net/static/images/exercise3/adm10.png?auto=format&amp;fit=max&amp;w=3840"/></div><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div><p>Copy the following YAML into the <code>Import YAML</code> field and click Create.</p><div class="relative"><pre><code class="language-yaml code-highlight"><span class="code-line"><span class="token atrule key">apiVersion</span> <span class="token punctuation">:</span> apps/v1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> Deployment
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> backend
</span><span class="code-line">  <span class="token atrule key">namespace</span><span class="token punctuation">:</span> %%replace<span class="token punctuation">-</span>me%%
</span><span class="code-line">  <span class="token atrule key">labels</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">app</span><span class="token punctuation">:</span> backend
</span><span class="code-line">    <span class="token atrule key">app.kubernetes.io/component</span><span class="token punctuation">:</span> backend
</span><span class="code-line">    <span class="token atrule key">app.kubernetes.io/instance</span><span class="token punctuation">:</span> backend
</span><span class="code-line">    <span class="token atrule key">app.kubernetes.io/name</span><span class="token punctuation">:</span> backend
</span><span class="code-line">    <span class="token atrule key">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> backend
</span><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
</span><span class="code-line">  <span class="token atrule key">selector</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">matchLabels</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">app</span><span class="token punctuation">:</span> backend
</span><span class="code-line">  <span class="token atrule key">template</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">labels</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token atrule key">app</span><span class="token punctuation">:</span> backend
</span><span class="code-line">    <span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">serviceAccountName</span><span class="token punctuation">:</span> default
</span><span class="code-line">      <span class="token atrule key">serviceAccount</span><span class="token punctuation">:</span> default  
</span><span class="code-line">      <span class="token atrule key">containers</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> backend
</span><span class="code-line">        <span class="token atrule key">image</span><span class="token punctuation">:</span> quay.io/the<span class="token punctuation">-</span>worst<span class="token punctuation">-</span>containers/pwnkit<span class="token punctuation">:</span>v0.6
</span><span class="code-line">        <span class="token atrule key">securityContext</span><span class="token punctuation">:</span>
</span><span class="code-line">          <span class="token atrule key">capabilities</span><span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token atrule key">add</span><span class="token punctuation">:</span>
</span><span class="code-line">             <span class="token punctuation">-</span> ALL
</span><span class="code-line">        <span class="token atrule key">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;sleep&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;infinity&quot;</span><span class="token punctuation">]</span>
</span></code></pre></div><p>If everything works you&#x27;ll see an error presented, showing that your deployment was blocked because it is vulnerable to PwnKit.</p><div data-rmiz-wrap="visible"><div><img alt="adm11" loading="lazy" width="1570" height="1169" decoding="async" data-nimg="1" style="color:transparent" srcSet="https://workshop-936810110.imgix.net/static/images/exercise3/adm11.png?auto=format&amp;fit=max&amp;w=1920 1x, https://workshop-936810110.imgix.net/static/images/exercise3/adm11.png?auto=format&amp;fit=max&amp;w=3840 2x" src="https://workshop-936810110.imgix.net/static/images/exercise3/adm11.png?auto=format&amp;fit=max&amp;w=3840"/></div><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div><h2 id="inspecting-admission-control-violations"><a href="#inspecting-admission-control-violations" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Inspecting admission control violations</h2><p>Red Hat Advanced Cluster Security for Kubernetes (RHACS) records policy violations, and can optionally send these to an external platform, like Splunk or Microsoft Sentinel.</p><p>Navigate to RHACS, and select &#x27;Violations&#x27;. You should be able to see a new violation for the <code>PwnKit campaign username</code> policy.</p><div data-rmiz-wrap="visible"><div><img alt="violation1" loading="lazy" width="1755" height="573" decoding="async" data-nimg="1" style="color:transparent" srcSet="https://workshop-936810110.imgix.net/static/images/exercise3/violation1.png?auto=format&amp;fit=max&amp;w=1920 1x, https://workshop-936810110.imgix.net/static/images/exercise3/violation1.png?auto=format&amp;fit=max&amp;w=3840 2x" src="https://workshop-936810110.imgix.net/static/images/exercise3/violation1.png?auto=format&amp;fit=max&amp;w=3840"/></div><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div><p>Digging into this policy violation shows the reason it was triggered. In this case, CVE-2021-4034 was discovered in a vulnerably <code>policykit-1</code> package in the container <code>backend</code>.</p><div data-rmiz-wrap="visible"><div><img alt="violation2" loading="lazy" width="1776" height="584" decoding="async" data-nimg="1" style="color:transparent" srcSet="https://workshop-936810110.imgix.net/static/images/exercise3/violation2.png?auto=format&amp;fit=max&amp;w=1920 1x, https://workshop-936810110.imgix.net/static/images/exercise3/violation2.png?auto=format&amp;fit=max&amp;w=3840 2x" src="https://workshop-936810110.imgix.net/static/images/exercise3/violation2.png?auto=format&amp;fit=max&amp;w=3840"/></div><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div><p>The violation also captures any enforcement activity. Here you can see that Red Hat Advanced Cluster Security for Kubernetes (RHACS) failed the &#x27;deployment create&#x27; as the container image was vulnerable to PwnKit.</p><div data-rmiz-wrap="visible"><div><img alt="violation3" loading="lazy" width="1779" height="629" decoding="async" data-nimg="1" style="color:transparent" srcSet="https://workshop-936810110.imgix.net/static/images/exercise3/violation3.png?auto=format&amp;fit=max&amp;w=1920 1x, https://workshop-936810110.imgix.net/static/images/exercise3/violation3.png?auto=format&amp;fit=max&amp;w=3840 2x" src="https://workshop-936810110.imgix.net/static/images/exercise3/violation3.png?auto=format&amp;fit=max&amp;w=3840"/></div><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div><p>Finally, you can see the policy that triggered this policy violation. In our case, it&#x27;s the <code>PwnKit campaign username</code> policy.</p><div data-rmiz-wrap="visible"><div><img alt="violation4" loading="lazy" width="1748" height="1124" decoding="async" data-nimg="1" style="color:transparent" srcSet="https://workshop-936810110.imgix.net/static/images/exercise3/violation4.png?auto=format&amp;fit=max&amp;w=1920 1x, https://workshop-936810110.imgix.net/static/images/exercise3/violation4.png?auto=format&amp;fit=max&amp;w=3840 2x" src="https://workshop-936810110.imgix.net/static/images/exercise3/violation4.png?auto=format&amp;fit=max&amp;w=3840"/></div><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div><h2 id="summary"><a href="#summary" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Summary</h2><p>In this lab we looked at blocking vulnerable applications from OpenShift, using the Red Hat Advanced Cluster Security for Kubernetes (RHACS) admission controller. In this exercise we used an existing policy created to report on PwnKit-vulnerable workloads, and changed the policy behaviour to block these at deployment-time.</p><h2 id="troubleshooting"><a href="#troubleshooting" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Troubleshooting</h2><p>You may see an error &quot;admission plugin ValidatingAdmissionWebhook failed to complete validation in 13s for field undefined&quot;</p><p>If this happens, just click &#x27;Create&#x27; again.</p><p>You may also see the message &quot;Error parsing YAML: YAMLException: bad indentation of a mapping entry at line 5, column 14: namespace: %%replace-me%%&quot;</p><p>Make sure that you replace the <code>namespace</code> field with your username.</p></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a href="/acs-intro-workshop/tags/admission"><a class="mr-3 text-sm font-medium uppercase text-primary-800 hover:text-primary-900 dark:hover:text-primary-400">admission</a></a><a href="/acs-intro-workshop/tags/control"><a class="mr-3 text-sm font-medium uppercase text-primary-800 hover:text-primary-900 dark:hover:text-primary-400">control</a></a><a href="/acs-intro-workshop/tags/openshift"><a class="mr-3 text-sm font-medium uppercase text-primary-800 hover:text-primary-900 dark:hover:text-primary-400">openshift</a></a><a href="/acs-intro-workshop/tags/rhacs"><a class="mr-3 text-sm font-medium uppercase text-primary-800 hover:text-primary-900 dark:hover:text-primary-400">rhacs</a></a><a href="/acs-intro-workshop/tags/cve"><a class="mr-3 text-sm font-medium uppercase text-primary-800 hover:text-primary-900 dark:hover:text-primary-400">cve</a></a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Exercise</h2><div class="text-primary-800 hover:text-primary-900 dark:hover:text-primary-400"><a href="/acs-intro-workshop/workshop/exercise2"><a>Creating customised CVE reports with RHACS</a></a></div></div><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Next Exercise</h2><div class="text-primary-800 hover:text-primary-900 dark:hover:text-primary-400"><a href="/acs-intro-workshop/workshop/exercise4"><a>Detecting unauthorized application behaviour at runtime with RHACS</a></a></div></div></div></div><div class="pt-4 xl:pt-8"><a href="/acs-intro-workshop/workshop"><a class="text-primary-800 hover:text-primary-900 dark:hover:text-primary-400">← Back to the exercise list</a></a></div></footer></div></div></article></div></main><footer><div class="flex flex-col items-center mt-16"><div class="flex mb-2 space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>© 2024</div><div> • </div><a href="/acs-intro-workshop"><a>Red Hat</a></a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var p=Object.create;var l=Object.defineProperty;var m=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var k=Object.getPrototypeOf,g=Object.prototype.hasOwnProperty;var o=a=\u003el(a,\"__esModule\",{value:!0});var y=(a,i)=\u003e()=\u003e(i||a((i={exports:{}}).exports,i),i.exports),N=(a,i)=\u003e{o(a);for(var c in i)l(a,c,{get:i[c],enumerable:!0})},f=(a,i,c)=\u003e{if(i\u0026\u0026typeof i==\"object\"||typeof i==\"function\")for(let n of u(i))!g.call(a,n)\u0026\u0026n!==\"default\"\u0026\u0026l(a,n,{get:()=\u003ei[n],enumerable:!(c=m(i,n))||c.enumerable});return a},b=a=\u003ef(o(l(a!=null?p(k(a)):{},\"default\",a\u0026\u0026a.__esModule\u0026\u0026\"default\"in a?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a);var d=y((A,r)=\u003e{r.exports=_jsx_runtime});var C={};N(C,{default:()=\u003ex,frontmatter:()=\u003ev});var e=b(d()),v={title:\"Blocking vulnerable workloads from OpenShift\",exercise:3,date:\"2024-06-03\",tags:[\"admission\",\"control\",\"openshift\",\"rhacs\",\"cve\"],draft:!1,authors:[\"default\"],summary:\"In the third exercise we'll block vulnerable container images from OpenShift\"};function w(a={}){let{wrapper:i}=a.components||{};return i?(0,e.jsx)(i,Object.assign({},a,{children:(0,e.jsx)(c,{})})):c();function c(){let n=Object.assign({p:\"p\",em:\"em\",ul:\"ul\",li:\"li\",strong:\"strong\",code:\"code\",h2:\"h2\",a:\"a\",span:\"span\",div:\"div\",pre:\"pre\"},a.components),{Zoom:t,Image:s}=n;return s||h(\"Image\",!0),t||h(\"Zoom\",!0),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(n.p,{children:\"So far we've looked at analysing CVEs that are exposed on OpenShift. We've looked at how to identify vulnerable container images, and how to create campaigns and generate data for specific high-interest CVEs.\"}),(0,e.jsxs)(n.p,{children:[\"But how did those CVEs get there in the first place? What if we could identify CVEs \",(0,e.jsx)(n.em,{children:\"before\"}),\" they become running code on the platform?\"]}),(0,e.jsx)(n.p,{children:\"Red Hat Advanced Cluster Security for Kubernetes (RHACS) supports a couple of ways of identifying / managing CVEs before they make it to OpenShift:\"}),(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Integrating CVE scanning into CI/CD pipelines.\"}),\" Red Hat Advanced Cluster Security for Kubernetes (RHACS) supports the \",(0,e.jsx)(n.code,{children:\"roxctl\"}),\" CLI, a portable binary that can be used to inject CVE scanning into any pipeline or development process.\"]})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Admission control\"}),\" Red Hat Advanced Cluster Security for Kubernetes (RHACS) pushes down a Kubernetes admission controller to secured OpenShift clusters. This means we can make decisions about allowing / blocking vulnerable workloads before they are accepted to the cluster.\"]})})]}),(0,e.jsxs)(\"details\",{children:[(0,e.jsx)(\"summary\",{children:(0,e.jsx)(\"strong\",{children:\"What is Kubernetes admission control?\"})}),\" \",(0,e.jsx)(\"p\",{children:\"An admission controller is a piece of code that intercepts requests to the Kubernetes API server prior to persistence of the object, but after the request is authenticated and authorized.\"}),(0,e.jsx)(\"p\",{children:\"Admission controllers limit requests to create, delete, modify objects. Admission controllers can also block custom verbs, such as a request connect to a Pod via an API server proxy. Admission controllers do not (and cannot) block requests to read (get, watch or list) objects.\"}),(0,e.jsx)(\"p\",{children:\"Red Hat Advanced Cluster Security for Kubernetes (RHACS) deploys a Kubernetes admission controller to secured clusters that can be used to validate applications for vulnerabilities or misconfiguration before being deployed to the cluster.\"})]}),(0,e.jsxs)(n.h2,{id:\"using-the-rhacs-admission-controller\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#using-the-rhacs-admission-controller\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Using the RHACS admission controller\"]}),(0,e.jsx)(n.p,{children:\"Let's take a closer look at the Red Hat Advanced Cluster Security for Kubernetes (RHACS) admission controller. In the previous exercise we created a policy for PwnKit, which we used to report on vulnerable workloads.\"}),(0,e.jsx)(t,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(s,{alt:\"adm1\",src:\"/static/images/exercise3/adm1.png\",width:\"1720\",height:\"1105\"})})}),(0,e.jsxs)(n.p,{children:[\"We're going to re-use this same policy to now \",(0,e.jsx)(n.strong,{children:\"block\"}),\" vulnerable container images from OpenShift. To get started, navigate to \",(0,e.jsx)(n.code,{children:\"Platform Configuration\"}),\" -\u003e \",(0,e.jsx)(n.code,{children:\"Policy Management\"}),\". Perform a search for \",(0,e.jsx)(n.code,{children:\"pwnkit\"}),\", and find the policy for your user.\"]}),(0,e.jsx)(t,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(s,{alt:\"adm2\",src:\"/static/images/exercise3/adm2.png\",width:\"1756\",height:\"845\"})})}),(0,e.jsx)(n.p,{children:\"Select 'Edit policy' from the 'kebab' menu on the right.\"}),(0,e.jsx)(t,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(s,{alt:\"adm3\",src:\"/static/images/exercise3/adm3.png\",width:\"1748\",height:\"880\"})})}),(0,e.jsx)(n.p,{children:\"There's no changes we need to make to the policy details, so let's click 'Next' on the first screen.\"}),(0,e.jsx)(t,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(s,{alt:\"adm4\",src:\"/static/images/exercise3/adm4.png\",width:\"1723\",height:\"995\"})})}),(0,e.jsx)(n.p,{children:\"We are going to make some changes to the 'Policy behavior' section. Change the 'Response method' from 'Inform' to 'Inform and enforce', and ensure that the toggle for 'Deploy' is switched to 'Enforce on Deploy'.\"}),(0,e.jsx)(t,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(s,{alt:\"adm5\",src:\"/static/images/exercise3/adm5.png\",width:\"1726\",height:\"1129\"})})}),(0,e.jsx)(n.p,{children:\"This means that our policy will now block any workloads vulnerable to PwnKit, whenever we try to create a new deployment or update an existing deployment. Great!\"}),(0,e.jsx)(n.p,{children:\"Click next to continue to the policy criteria. There's no other changes we need to make here, so just click 'Next'.\"}),(0,e.jsx)(t,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(s,{alt:\"adm6\",src:\"/static/images/exercise3/adm6.png\",width:\"1748\",height:\"687\"})})}),(0,e.jsxs)(n.p,{children:[\"We're going to add an inclusive scope for this policy, so that it only targets each users' namespace. Next to 'Restrict by scope' click the \",(0,e.jsx)(n.code,{children:\"Add inclusion scope\"}),\" button.\"]}),(0,e.jsx)(t,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(s,{alt:\"adm7\",src:\"/static/images/exercise3/adm7.png\",width:\"1738\",height:\"1090\"})})}),(0,e.jsxs)(n.p,{children:[\"Select \",(0,e.jsx)(n.code,{children:\"openshift\"}),\" from the 'Cluster' drop-down, and enter your workshop username for the 'Namespace'. The inclusive scope should look like this:\"]}),(0,e.jsx)(t,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(s,{alt:\"adm8\",src:\"/static/images/exercise3/adm8.png\",width:\"1711\",height:\"885\"})})}),(0,e.jsx)(n.p,{children:\"Select 'Next' and review the policy. You should check that the 'Policy behaviour' is set to 'Deploy' for Enforcement, and that there is an inclusive policy scope defined.\"}),(0,e.jsx)(t,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(s,{alt:\"adm9\",src:\"/static/images/exercise3/adm9.png\",width:\"1540\",height:\"1238\"})})}),(0,e.jsx)(n.p,{children:\"When you're happy, click 'Save'.\"}),(0,e.jsxs)(n.h2,{id:\"trying-out-the-new-policy\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#trying-out-the-new-policy\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Trying out the new policy\"]}),(0,e.jsx)(n.p,{children:\"Let's try out the new policy for PwnKit and make sure that blocks vulnerable container images.\"}),(0,e.jsxs)(n.p,{children:[\"Login to OpenShift and navigate to your individual project. Select the \",(0,e.jsx)(n.code,{children:\"+\"}),\" in the top-right corner of OpenShift to create a new deployment.\"]}),(0,e.jsx)(t,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(s,{alt:\"adm10\",src:\"/static/images/exercise3/adm10.png\",width:\"1566\",height:\"959\"})})}),(0,e.jsxs)(n.p,{children:[\"Copy the following YAML into the \",(0,e.jsx)(n.code,{children:\"Import YAML\"}),\" field and click Create.\"]}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"language-yaml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"apiVersion\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` apps/v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Deployment\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` backend\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"namespace\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" %%replace\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`me%%\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"labels\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"app\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` backend\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"app.kubernetes.io/component\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` backend\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"app.kubernetes.io/instance\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` backend\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"app.kubernetes.io/name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` backend\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"app.kubernetes.io/part-of\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` backend\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"replicas\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"selector\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"matchLabels\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"app\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` backend\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"template\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"labels\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"app\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` backend\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"serviceAccountName\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` default\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"serviceAccount\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` default  \n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"containers\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` backend\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"image\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" quay.io/the\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"worst\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"containers/pwnkit\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`v0.6\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"securityContext\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"capabilities\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"add\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"             \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),` ALL\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"command\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"sleep\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"infinity\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"If everything works you'll see an error presented, showing that your deployment was blocked because it is vulnerable to PwnKit.\"}),(0,e.jsx)(t,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(s,{alt:\"adm11\",src:\"/static/images/exercise3/adm11.png\",width:\"1570\",height:\"1169\"})})}),(0,e.jsxs)(n.h2,{id:\"inspecting-admission-control-violations\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#inspecting-admission-control-violations\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Inspecting admission control violations\"]}),(0,e.jsx)(n.p,{children:\"Red Hat Advanced Cluster Security for Kubernetes (RHACS) records policy violations, and can optionally send these to an external platform, like Splunk or Microsoft Sentinel.\"}),(0,e.jsxs)(n.p,{children:[\"Navigate to RHACS, and select 'Violations'. You should be able to see a new violation for the \",(0,e.jsx)(n.code,{children:\"PwnKit campaign username\"}),\" policy.\"]}),(0,e.jsx)(t,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(s,{alt:\"violation1\",src:\"/static/images/exercise3/violation1.png\",width:\"1755\",height:\"573\"})})}),(0,e.jsxs)(n.p,{children:[\"Digging into this policy violation shows the reason it was triggered. In this case, CVE-2021-4034 was discovered in a vulnerably \",(0,e.jsx)(n.code,{children:\"policykit-1\"}),\" package in the container \",(0,e.jsx)(n.code,{children:\"backend\"}),\".\"]}),(0,e.jsx)(t,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(s,{alt:\"violation2\",src:\"/static/images/exercise3/violation2.png\",width:\"1776\",height:\"584\"})})}),(0,e.jsx)(n.p,{children:\"The violation also captures any enforcement activity. Here you can see that Red Hat Advanced Cluster Security for Kubernetes (RHACS) failed the 'deployment create' as the container image was vulnerable to PwnKit.\"}),(0,e.jsx)(t,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(s,{alt:\"violation3\",src:\"/static/images/exercise3/violation3.png\",width:\"1779\",height:\"629\"})})}),(0,e.jsxs)(n.p,{children:[\"Finally, you can see the policy that triggered this policy violation. In our case, it's the \",(0,e.jsx)(n.code,{children:\"PwnKit campaign username\"}),\" policy.\"]}),(0,e.jsx)(t,{children:(0,e.jsx)(n.div,{children:(0,e.jsx)(s,{alt:\"violation4\",src:\"/static/images/exercise3/violation4.png\",width:\"1748\",height:\"1124\"})})}),(0,e.jsxs)(n.h2,{id:\"summary\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#summary\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Summary\"]}),(0,e.jsx)(n.p,{children:\"In this lab we looked at blocking vulnerable applications from OpenShift, using the Red Hat Advanced Cluster Security for Kubernetes (RHACS) admission controller. In this exercise we used an existing policy created to report on PwnKit-vulnerable workloads, and changed the policy behaviour to block these at deployment-time.\"}),(0,e.jsxs)(n.h2,{id:\"troubleshooting\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#troubleshooting\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Troubleshooting\"]}),(0,e.jsx)(n.p,{children:'You may see an error \"admission plugin ValidatingAdmissionWebhook failed to complete validation in 13s for field undefined\"'}),(0,e.jsx)(n.p,{children:\"If this happens, just click 'Create' again.\"}),(0,e.jsx)(n.p,{children:'You may also see the message \"Error parsing YAML: YAMLException: bad indentation of a mapping entry at line 5, column 14: namespace: %%replace-me%%\"'}),(0,e.jsxs)(n.p,{children:[\"Make sure that you replace the \",(0,e.jsx)(n.code,{children:\"namespace\"}),\" field with your username.\"]})]})}}var x=w;function h(a,i){throw new Error(\"Expected \"+(i?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return C;})();\n;return Component;","toc":[{"value":"Using the RHACS admission controller","url":"#using-the-rhacs-admission-controller","depth":2},{"value":"Trying out the new policy","url":"#trying-out-the-new-policy","depth":2},{"value":"Inspecting admission control violations","url":"#inspecting-admission-control-violations","depth":2},{"value":"Summary","url":"#summary","depth":2},{"value":"Troubleshooting","url":"#troubleshooting","depth":2}],"frontMatter":{"readingTime":{"text":"6 min read","minutes":5.31,"time":318600,"words":1062},"slug":"exercise3","fileName":"exercise3.mdx","title":"Blocking vulnerable workloads from OpenShift","exercise":3,"date":"2024-06-03T00:00:00.000Z","tags":["admission","control","openshift","rhacs","cve"],"draft":false,"authors":["default"],"summary":"In the third exercise we'll block vulnerable container images from OpenShift"}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.24,"time":14400,"words":48},"slug":["default"],"fileName":"default.md","date":null}],"prev":{"title":"Creating customised CVE reports with RHACS","exercise":2,"date":"2024-06-02T00:00:00.000Z","tags":["rhacs","cve","campaigns","pwnkit","openshift","security"],"draft":false,"authors":["default"],"summary":"In the second exercise we'll generate and export data for a CVE campaign, using the RHACS RESTful API.","slug":"exercise2"},"next":{"title":"Detecting unauthorized application behaviour at runtime with RHACS","exercise":4,"date":"2024-06-04T00:00:00.000Z","tags":["runtime","unauthorized","openshift","rhacs","ebpf"],"draft":false,"authors":["default"],"summary":"In this exercise we'll identify and block unauthorized behaviours in container applications at runtime.","slug":"exercise4"}},"__N_SSG":true},"page":"/workshop/[...slug]","query":{"slug":["exercise3"]},"buildId":"8cbUt7puzyI2HzQphIGdu","assetPrefix":"/acs-intro-workshop","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>